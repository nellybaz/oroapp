parameters:
    # Entities
    oro_mailchimp.entity.campaign.class: Oro\Bundle\MailChimpBundle\Entity\Campaign
    oro_mailchimp.entity.template.class: Oro\Bundle\MailChimpBundle\Entity\Template
    oro_mailchimp.entity.subscribers_list.class: Oro\Bundle\MailChimpBundle\Entity\SubscribersList
    oro_mailchimp.entity.member.class: Oro\Bundle\MailChimpBundle\Entity\Member
    oro_mailchimp.entity.member_activity.class: Oro\Bundle\MailChimpBundle\Entity\MemberActivity
    oro_mailchimp.entity.static_segment.class: Oro\Bundle\MailChimpBundle\Entity\StaticSegment
    oro_mailchimp.entity.static_segment_member.class: Oro\Bundle\MailChimpBundle\Entity\StaticSegmentMember
    oro_mailchimp.entity.extended_merge_var.class: Oro\Bundle\MailChimpBundle\Entity\ExtendedMergeVar
    oro_mailchimp.entity.member_extended_merge_var.class: Oro\Bundle\MailChimpBundle\Entity\MemberExtendedMergeVar
    oro_mailchimp.entity.marketing_list_email.class: Oro\Bundle\MailChimpBundle\Entity\MarketingListEmail
    oro_mailchimp.entity.static_segment_member_to_remove.class: Oro\Bundle\MailChimpBundle\Entity\StaticSegmentMemberToRemove

    oro_mailchimp.transport.mailchimp.class: Oro\Bundle\MailChimpBundle\Transport\MailChimpTransport
    oro_mailchimp.model.field_helper.class: Oro\Bundle\MailChimpBundle\Model\FieldHelper
    oro_mailchimp.validator.email_column.class: Oro\Bundle\MailChimpBundle\Validator\EmailColumnValidator
    oro_mailchimp.validator.unique_static_segment_name.class: Oro\Bundle\MailChimpBundle\Validator\UniqueStaticSegmentNameValidator
    oro_mailchimp.placeholder.filter.buttons_filder.class: Oro\Bundle\MailChimpBundle\Placeholder\ButtonsPlaceholderFilter

    # Forms and extensions
    oro_mailchimp.form.extension.channel_connectors.class: Oro\Bundle\MailChimpBundle\Form\Extension\ChannelConnectorsExtension
    oro_mailchimp.form.type.integration_transport_settings.class: Oro\Bundle\MailChimpBundle\Form\Type\IntegrationSettingsType
    oro_mailchimp.form.type.integration_select.class: Oro\Bundle\MailChimpBundle\Form\Type\MailChimpIntegrationSelectType
    oro_mailchimp.form.type.template_select.class: Oro\Bundle\MailChimpBundle\Form\Type\MailchimpTemplateSelectType
    oro_mailchimp.form.type.list_select.class: Oro\Bundle\MailChimpBundle\Form\Type\MailchimpListSelectType
    oro_mailchimp.form.type.transport_settings.class: Oro\Bundle\MailChimpBundle\Form\Type\MailChimpTransportSettingsType
    oro_mailchimp.form.type.api_key_type.class: Oro\Bundle\MailChimpBundle\Form\Type\ApiKeyType
    oro_mailchimp.form.type.marketing_list_connecion.class: Oro\Bundle\MailChimpBundle\Form\Type\MarketingListConnectionType
    oro_mailchimp.form.type.static_segment_sync_mode.class: Oro\Bundle\MailChimpBundle\Form\Type\StaticSegmentSyncModeType
    oro_mailchimp.form.autocomplete.template.search_handler.class: Oro\Bundle\MailChimpBundle\Autocomplete\TemplateSearchHandler
    oro_mailchimp.form.autocomplete.list.search_handler.class: Oro\Bundle\MailChimpBundle\Autocomplete\ListSearchHandler
    oro_mailchimp.static_segment.manager.api.class: Oro\Bundle\SoapBundle\Entity\Manager\ApiEntityManager

    # Integration related services
    oro_mailchimp.transport.integration_transport.class: Oro\Bundle\MailChimpBundle\Provider\Transport\MailChimpTransport
    oro_mailchimp.provider.channel_type.class: Oro\Bundle\MailChimpBundle\Provider\ChannelType
    oro_mailchimp.client.factory.class: Oro\Bundle\MailChimpBundle\Provider\Transport\MailChimpClientFactory

    # Readers
    oro_mailchimp.importexport.reader.processed_entities.class: Oro\Bundle\MailChimpBundle\ImportExport\Reader\ProcessedEntities
    oro_mailchimp.importexport.reader.static_segment.class: Oro\Bundle\MailChimpBundle\ImportExport\Reader\StaticSegmentReader
    oro_mailchimp.importexport.reader.iterator_based.class: Oro\Bundle\MailChimpBundle\ImportExport\Reader\AbstractIteratorBasedReader
    oro_mailchimp.importexport.reader.member_export.class: Oro\Bundle\MailChimpBundle\ImportExport\Reader\MemberExportReader
    oro_mailchimp.importexport.reader.extended_merge_var_export.class: Oro\Bundle\MailChimpBundle\ImportExport\Reader\ExtendedMergeVarExportReader
    oro_mailchimp.importexport.reader.mmbr_extd_merge_var_export.class: Oro\Bundle\MailChimpBundle\ImportExport\Reader\MemberExtendedMergeVarExportReader

    # Writers
    oro_mailchimp.importexport.writer.remove.class: Oro\Bundle\MailChimpBundle\ImportExport\Writer\RemoveWriter
    oro_mailchimp.importexport.writer.campaign_remove.class: Oro\Bundle\MailChimpBundle\ImportExport\Writer\CampaignRemoveWriter
    oro_mailchimp.importexport.writer.member.class: Oro\Bundle\MailChimpBundle\ImportExport\Writer\MemberWriter
    oro_mailchimp.importexport.writer.static_segment.class: Oro\Bundle\MailChimpBundle\ImportExport\Writer\StaticSegmentExportWriter
    oro_mailchimp.importexport.writer.extended_merge_var.class: Oro\Bundle\MailChimpBundle\ImportExport\Writer\ExtendedMergeVarExportWriter
    oro_mailchimp.importexport.writer.mmbr_extd_merge_var.class: Oro\Bundle\MailChimpBundle\ImportExport\Writer\MmbrExtdMergeVarExportWriter
    oro_mailchimp.importexport.writer.static_segment_member_add.class: Oro\Bundle\MailChimpBundle\ImportExport\Writer\StaticSegmentMemberAddStateWriter
    oro_mailchimp.importexport.writer.static_segment_member_state.class: Oro\Bundle\MailChimpBundle\ImportExport\Writer\StaticSegmentMemberStateWriter
    oro_mailchimp.importexport.writer.marketing_list_email.class: Oro\Bundle\MailChimpBundle\ImportExport\Writer\MarketingListEmailWriter
    oro_mailchimp.importexport.writer.prepare_static_segment_member_to_remove.class: Oro\Bundle\MailChimpBundle\ImportExport\Writer\StaticSegmentMemberToRemoveWriter
    oro_mailchimp.importexport.writer.members_sync.class: Oro\Bundle\MailChimpBundle\ImportExport\Writer\MemberSyncWriter
    oro_mailchimp.importexport.writer.loggable_persistent_batch_writer.class: Oro\Bundle\MailChimpBundle\ImportExport\Writer\LoggablePersistentBatchWriter

    # Serializers
    oro_mailchimp.importexport.serializer.datetime.class: Oro\Bundle\MailChimpBundle\ImportExport\Serializer\DateTimeSerializer
    oro_mailchimp.importexport.serializer.memeber_extended_merge_var.class: Oro\Bundle\MailChimpBundle\ImportExport\Serializer\MemberExtendedMergeVarSerializer
    oro_mailchimp.importexport.serializer.member_import.class: Oro\Bundle\MailChimpBundle\ImportExport\Serializer\MemberImportSerializer
    oro_mailchimp.importexport.serializer.member_activity.class: Oro\Bundle\MailChimpBundle\ImportExport\Serializer\MemberActivitySerializer

    # Strategies
    oro_mailchimp.importexport.strategy.abstract.class: Oro\Bundle\MailChimpBundle\ImportExport\Strategy\AbstractImportStrategy
    oro_mailchimp.importexport.strategy.campaign.class: Oro\Bundle\MailChimpBundle\ImportExport\Strategy\CampaignImportStrategy
    oro_mailchimp.importexport.strategy.template.class: Oro\Bundle\MailChimpBundle\ImportExport\Strategy\TemplateImportStrategy
    oro_mailchimp.importexport.strategy.list.class: Oro\Bundle\MailChimpBundle\ImportExport\Strategy\ListImportStrategy
    oro_mailchimp.importexport.strategy.member.class: Oro\Bundle\MailChimpBundle\ImportExport\Strategy\MemberImportStrategy
    oro_mailchimp.importexport.strategy.member_activity.class: Oro\Bundle\MailChimpBundle\ImportExport\Strategy\MemberActivityImportStrategy
    oro_mailchimp.importexport.strategy.static_segment.class: Oro\Bundle\MailChimpBundle\ImportExport\Strategy\StaticSegmentImportStrategy
    oro_mailchimp.importexport.strategy.memeber_extended_merge_var.class: Oro\Bundle\MailChimpBundle\ImportExport\Strategy\MemberExtendedMergeVarStrategy
    oro_mailchimp.importexport.strategy.export_member.class: Oro\Bundle\MailChimpBundle\ImportExport\Strategy\MemberExportStrategy

    # Connectors
    oro_mailchimp.connector.template.class: Oro\Bundle\MailChimpBundle\Provider\Connector\TemplateConnector
    oro_mailchimp.connector.list.class: Oro\Bundle\MailChimpBundle\Provider\Connector\ListConnector
    oro_mailchimp.connector.member.class: Oro\Bundle\MailChimpBundle\Provider\Connector\MemberConnector
    oro_mailchimp.connector.member_activity.class: Oro\Bundle\MailChimpBundle\Provider\Connector\MemberActivityConnector
    oro_mailchimp.connector.member_activity_send.class: Oro\Bundle\MailChimpBundle\Provider\Connector\MemberSendActivityConnector
    oro_mailchimp.connector.member_activity_abuse.class: Oro\Bundle\MailChimpBundle\Provider\Connector\MemberAbuseActivityConnector
    oro_mailchimp.connector.member_activity_unsubscribe.class: Oro\Bundle\MailChimpBundle\Provider\Connector\MemberUnsubscribeActivityConnector
    oro_mailchimp.connector.static_segment.class: Oro\Bundle\MailChimpBundle\Provider\Connector\StaticSegmentConnector
    oro_mailchimp.connector.campaign.class: Oro\Bundle\MailChimpBundle\Provider\Connector\CampaignConnector

    # Data Converter
    oro_mailchimp.importexport.data_converter.template.class: Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\TemplateDataConverter
    oro_mailchimp.importexport.data_converter.list.class: Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\ListDataConverter
    oro_mailchimp.importexport.data_converter.member.class: Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberDataConverter
    oro_mailchimp.importexport.data_converter.member_activity.class: Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberActivityDataConverter
    oro_mailchimp.importexport.data_converter.member_activity_send.class: Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberSendActivityDataConverter
    oro_mailchimp.importexport.data_converter.member_activity_abuse.class: Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberAbuseActivityDataConverter
    oro_mailchimp.importexport.data_converter.member_activity_unsubscribe.class: Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberUnsubscribeActivityDataConverter
    oro_mailchimp.importexport.data_converter.campaign.class: Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\CampaignDataConverter
    oro_mailchimp.importexport.data_converter.static_segment.class: Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\StaticSegmentDataConverter
    oro_mailchimp.importexport.data_converter.extended_merge_var.class: Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\ExtendedMergeVarDataConverter
    oro_mailchimp.importexport.data_converter.member_extended_merge_var.class: Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberExtendedMergeVarDataConverter

    # Import Processors
    oro_mailchimp.importexport.processor.import.class: Oro\Bundle\MailChimpBundle\ImportExport\Processor\ImportProcessor
    oro_mailchimp.importexport.processor.remove.class: Oro\Bundle\MailChimpBundle\ImportExport\Processor\RemoveProcessor
    oro_mailchimp.importexport.processor.campaign_remove.class: Oro\Bundle\MailChimpBundle\ImportExport\Processor\CampaignRemoveProcessor
    oro_mailchimp.importexport.processor.dummy.class:  Oro\Bundle\MailChimpBundle\ImportExport\Processor\DummyProcessor

    # Export Processors
    oro_mailchimp.importexport.processor.export_member.class: Oro\Bundle\MailChimpBundle\ImportExport\Processor\ExportProcessor
    oro_mailchimp.importexport.processor.export_static_segment.class: Oro\Bundle\MailChimpBundle\ImportExport\Processor\ExportProcessor

    # MergeVar related services
    oro_mailchimp.merge_var.provider.class: Oro\Bundle\MailChimpBundle\Model\MergeVar\MergeVarProvider

    # Workflow actions and conditions
    oro_mailchimp.workflow.action.update_email_campaign_statistics.class: Oro\Bundle\MailChimpBundle\Model\Action\UpdateEmailCampaignStatistics
    oro_mailchimp.workflow.action.abstract_marketing_list_entities.class: Oro\Bundle\MailChimpBundle\Model\Action\AbstractMarketingListEntitiesAction
    oro_mailchimp.workflow.action.create_marketing_list_state_item.class: Oro\Bundle\MailChimpBundle\Model\Action\MarketingListStateItemAction

    # EmailCampaign Voter
    oro_mailchimp.email_campaign.security.acl.voter.entity.class: Oro\Bundle\MailChimpBundle\Acl\Voter\EmailCampaignVoter
    oro_mailchimp.acl.voter.marketing_list_state_item.class: Oro\Bundle\MailChimpBundle\Acl\Voter\MarketingListStateItemVoter

    oro_mailchimp.static_segment_manager.state_manager.class: Oro\Bundle\MailChimpBundle\Model\StaticSegment\StaticSegmentsMemberStateManager

    # Iterators
    oro_mailchimp.iterator.static_segment.class: Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\AbstractStaticSegmentIterator
    oro_mailchimp.iterator.member_sync.class: Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\MemberSyncIterator
    oro_mailchimp.iterator.static_segment_member_add_state.class: Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\StaticSegmentMemberAddStateIterator
    oro_mailchimp.iterator.static_segment_member_remove_state.class: Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\StaticSegmentMemberRemoveStateIterator
    oro_mailchimp.iterator.static_segment_member_dropped_state.class: Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\StaticSegmentMemberDroppedStateIterator
    oro_mailchimp.iterator.extended_merge_var_add.class: Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\ExtendedMergeVarAddIterator
    oro_mailchimp.iterator.extended_merge_var_remove.class: Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\ExtendedMergeVarRemoveIterator
    oro_mailchimp.iterator.mmbr_extd_merge_var.class: Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\MmbrExtdMergeVarIterator
    oro_mailchimp.iterator.marketing_list_email.class: Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\MarketingListEmailIterator
    oro_mailchimp.iterator.static_segment_member_to_remove.class: Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\StaticSegmentMemberToRemoveIterator
    oro_mailchimp.iterator.static_segment_members.abstract.class: Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\AbstractStaticSegmentMembersIterator

    # Placeholder filter
    oro_mailchimp.placeholder.filter.marketing_list.class: Oro\Bundle\MailChimpBundle\Placeholder\MarketingListPlaceholderFilter
    oro_mailchimp.placeholder.filter.email_campaign.class: Oro\Bundle\MailChimpBundle\Placeholder\EmailCampaignPlaceholderFilter

    # Extended Merge Vars
    oro_mailchimp.segment.column_definition.factory.class: Oro\Bundle\MailChimpBundle\Model\Segment\ColumnDefinitionListFactory
    oro_mailchimp.extended_merge_var.composite_provider.class: Oro\Bundle\MailChimpBundle\Model\ExtendedMergeVar\Provider
    oro_mailchimp.marketinglist.datagrid_provider.class: Oro\Bundle\MailChimpBundle\Model\MarketingList\DataGridProvider

services:
    oro_mailchimp.client.factory:
        class: %oro_mailchimp.client.factory.class%

    oro_mailchimp.transport.mailchimp:
        class: %oro_mailchimp.transport.mailchimp.class%
        tags:
            - { name: "oro_campaign.email_transport" }

    oro_mailchimp.model.field_helper:
        class: %oro_mailchimp.model.field_helper.class%
        arguments:
            - "@oro_entity.virtual_field_provider"

    oro_mailchimp.validator.email_column:
        class: %oro_mailchimp.validator.email_column.class%
        arguments:
            - "@oro_marketing_list.contact_information_column_validator"
            - "@doctrine"
        tags:
            - { name: validator.constraint_validator, alias: oro_mailchimp.validator.email_column }

    oro_mailchimp.validator.unique_static_segment_name:
        class: %oro_mailchimp.validator.unique_static_segment_name.class%
        arguments:
            - "@oro_mailchimp.transport.integration_transport"
        tags:
            - { name: validator.constraint_validator, alias: oro_mailchimp.validator.unique_static_segment_name }

    oro_mailchimp.placeholder.filter.buttons_filder:
        class: %oro_mailchimp.placeholder.filter.buttons_filder.class%
        arguments:
            - "@oro_marketing_list.provider.contact_information_fields"
            - "@doctrine"

    oro_mailchimp.static_segment.manager.api:
        parent: oro_soap.manager.entity_manager.abstract
        class: %oro_mailchimp.static_segment.manager.api.class%
        arguments:
            - %oro_mailchimp.entity.static_segment.class%
            - "@doctrine.orm.entity_manager"

    # Readers
    oro_mailchimp.importexport.reader.processed_entities:
        class: %oro_mailchimp.importexport.reader.processed_entities.class%
        arguments:
            - "@oro_importexport.context_registry"

    oro_mailchimp.importexport.reader.static_segment:
        class: %oro_mailchimp.importexport.reader.static_segment.class%
        parent: oro_mailchimp.importexport.reader.abstract_iterator_based
        calls:
            - [setMarketingListClassName, [%oro_marketing_list.entity.class%]]
            - [setStaticSegmentClassName, [%oro_mailchimp.entity.static_segment.class%]]

    oro_mailchimp.importexport.reader.marketing_list_email:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.marketing_list_email"]]

    oro_mailchimp.importexport.reader.members_sync:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.member_sync"]]

    oro_mailchimp.importexport.reader.static_segment_member_add_state:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.static_segment_member_add_state"]]

    oro_mailchimp.importexport.reader.static_segment_member_remove_state:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.static_segment_member_remove_state"]]

    oro_mailchimp.importexport.reader.static_segment_member_unsubscribe_state:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.static_segment_member_unsubscribe_state"]]

    oro_mailchimp.importexport.reader.static_segment_member_unsubscribe_delete_state:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.static_segment_member_unsubscribe_delete_state"]]

    oro_mailchimp.importexport.reader.static_segment_member_dropped_state:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.static_segment_member_dropped_state"]]

    oro_mailchimp.importexport.reader.abstract_iterator_based:
        class: %oro_mailchimp.importexport.reader.iterator_based.class%
        abstract: true
        arguments:
            - "@oro_importexport.context_registry"
            - "@oro_entity.doctrine_helper"
            - %oro_integration.entity.class%

    oro_mailchimp.importexport.reader.member_export:
        class: %oro_mailchimp.importexport.reader.member_export.class%
        parent: oro_mailchimp.importexport.reader.abstract_iterator_based
        calls:
            - [setMemberClassName, [%oro_mailchimp.entity.member.class%]]
            - [setSubscribersListClassName, [%oro_mailchimp.entity.subscribers_list.class%]]

    oro_mailchimp.importexport.reader.static_segment_export:
        parent: oro_mailchimp.importexport.reader.static_segment

    oro_mailchimp.importexport.reader.static_segment_member_out_of_list:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.static_segment_member_out_of_list"]]

    oro_mailchimp.importexport.reader.extended_merge_var_add:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.extended_merge_var_add"]]

    oro_mailchimp.importexport.reader.extended_merge_var_remove:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.extended_merge_var_remove"]]

    oro_mailchimp.importexport.reader.extended_merge_var_export:
        class: %oro_mailchimp.importexport.reader.extended_merge_var_export.class%
        parent: oro_mailchimp.importexport.reader.abstract_iterator_based
        calls:
            - [setStaticSegmentClassName, [%oro_mailchimp.entity.static_segment.class%]]
            - [setExtendedMergeVarClassName, [%oro_mailchimp.entity.extended_merge_var.class%]]

    oro_mailchimp.importexport.reader.member_extended_merge_var_add:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.mmbr_extd_merge_var"]]

    oro_mailchimp.importexport.reader.mmbr_extd_merge_var_export:
        class: %oro_mailchimp.importexport.reader.mmbr_extd_merge_var_export.class%
        parent: oro_mailchimp.importexport.reader.abstract_iterator_based
        calls:
            - [setStaticSegmentClassName, [%oro_mailchimp.entity.static_segment.class%]]
            - [setMmbrExtdMergeVarClassName, [%oro_mailchimp.entity.member_extended_merge_var.class%]]

    # Writers
    oro_mailchimp.importexport.writer.template.remove:
        class: %oro_mailchimp.importexport.writer.remove.class%
        arguments:
            - "@doctrine"
            - %oro_mailchimp.entity.template.class%
            - 'originId'

    oro_mailchimp.importexport.writer.list.remove:
        class: %oro_mailchimp.importexport.writer.remove.class%
        arguments:
            - "@doctrine"
            - %oro_mailchimp.entity.subscribers_list.class%
            - 'originId'

    oro_mailchimp.importexport.writer.campaign.remove:
        class: %oro_mailchimp.importexport.writer.campaign_remove.class%
        arguments:
            - "@doctrine"
            - %oro_mailchimp.entity.campaign.class%
            - 'originId'
            - 'regular'

    oro_mailchimp.importexport.writer.abstract_export:
        abstract: true
        parent: oro_integration.writer.persistent_batch_writer
        calls:
            - [setTransport, ["@oro_mailchimp.transport.integration_transport"]]

    oro_mailchimp.importexport.writer.member:
        class: %oro_mailchimp.importexport.writer.member.class%
        parent: oro_mailchimp.importexport.writer.abstract_export

    oro_mailchimp.importexport.writer.static_segment:
        class: %oro_mailchimp.importexport.writer.static_segment.class%
        parent: oro_mailchimp.importexport.writer.abstract_export
        calls:
            - [setStaticSegmentMemberClassName, [%oro_mailchimp.entity.static_segment_member.class%]]
            - [setMemberClassName, [%oro_mailchimp.entity.member.class%]]

    oro_mailchimp.importexport.writer.extended_merge_var:
        class: %oro_mailchimp.importexport.writer.extended_merge_var.class%
        parent: oro_mailchimp.importexport.writer.abstract_export

    oro_mailchimp.importexport.writer.mmbr_extd_merge_var:
        class: %oro_mailchimp.importexport.writer.mmbr_extd_merge_var.class%
        parent: oro_mailchimp.importexport.writer.abstract_export

    oro_mailchimp.importexport.writer.static_segment_member_add:
        parent: oro_importexport.writer.insert_from_select_writer
        class: %oro_mailchimp.importexport.writer.static_segment_member_add.class%
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setEntityName, [%oro_mailchimp.entity.static_segment_member.class%]]
            - [setFields, [['member', 'staticSegment', 'state']]]

    oro_mailchimp.importexport.writer.static_segment_member_state:
        class: %oro_mailchimp.importexport.writer.static_segment_member_state.class%
        arguments:
            - "@oro_entity.orm.native_query_executor_helper"
        calls:
            - [setEntityName, [%oro_mailchimp.entity.static_segment_member.class%]]

    oro_mailchimp.importexport.writer.marketing_list_email:
        parent: oro_importexport.writer.insert_from_select_writer
        class: %oro_mailchimp.importexport.writer.marketing_list_email.class%
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setEntityName, [%oro_mailchimp.entity.marketing_list_email.class%]]
            - [setFields, [['marketingList', 'email', 'state']]]

    oro_mailchimp.importexport.writer.prepare_static_segment_member_to_remove:
        parent: oro_importexport.writer.insert_from_select_writer
        class: %oro_mailchimp.importexport.writer.prepare_static_segment_member_to_remove.class%
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setEntityName, [%oro_mailchimp.entity.static_segment_member_to_remove.class%]]
            - [setFields, [['member', 'staticSegment', 'state']]]

    oro_mailchimp.importexport.writer.members_sync:
        parent: oro_importexport.writer.insert_from_select_writer
        class: %oro_mailchimp.importexport.writer.members_sync.class%
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setEntityName, [%oro_mailchimp.entity.member.class%]]
            - [setFields, [['owner', 'subscribersList', 'channel', 'status', 'createdAt', 'mergeVarValues']]]

    oro_mailchimp.importexport.writer.loggable_persistent_batch_writer:
        class: %oro_mailchimp.importexport.writer.loggable_persistent_batch_writer.class%
        parent: oro_integration.writer.persistent_batch_writer

    #Serializers
    oro_mailchimp.importexport.serializer.datetime:
        class: %oro_mailchimp.importexport.serializer.datetime.class%
        tags:
            - { name: oro_importexport.normalizer }

    oro_mailchimp.importexport.serializer.member_import:
        class: %oro_mailchimp.importexport.serializer.member_import.class%
        calls:
            - [setChannelEntity, [%oro_integration.entity.class%]]
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]
            - [setDateTimeSerializer, ["@oro_mailchimp.importexport.serializer.datetime"]]
        tags:
            - { name: oro_importexport.normalizer }

    oro_mailchimp.importexport.serializer.member_activity:
        class: %oro_mailchimp.importexport.serializer.member_activity.class%
        calls:
            - [setChannelEntity, [%oro_integration.entity.class%]]
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]
            - [setDateTimeSerializer, ["@oro_mailchimp.importexport.serializer.datetime"]]
        tags:
            - { name: oro_importexport.normalizer }

    oro_mailchimp.importexport.serializer.memeber_extended_merge_var:
        class: %oro_mailchimp.importexport.serializer.memeber_extended_merge_var.class%
        arguments:
            - "@oro_entity.helper.field_helper"
            - "@oro_importexport.field.database_helper"
            - "@oro_mailchimp.marketinglist.datagrid_provider"
            - "@translator"
            - "@oro_locale.formatter.number"
            - "@oro_locale.formatter.date_time"
            - %oro_mailchimp.entity.member_extended_merge_var.class%
        calls:
            - [setDispatcher, ["@event_dispatcher"]]
        tags:
            - { name: oro_importexport.normalizer, priority: -6 }

    # Forms and extensions
    oro_mailchimp.form.extension.channel_connectors:
        class: %oro_mailchimp.form.extension.channel_connectors.class%
        tags:
            - { name: form.type_extension, alias: oro_integration_channel_form }

    oro_mailchimp.form.type.api_key_type:
        class: %oro_mailchimp.form.type.api_key_type.class%
        tags:
            - { name: form.type, alias: "oro_mailchimp_api_key_type" }

    oro_mailchimp.form.type.integration_transport_settings:
        class: %oro_mailchimp.form.type.integration_transport_settings.class%
        tags:
            - { name: form.type, alias: "oro_mailchimp_integration_transport_setting_type" }

    oro_mailchimp.form.type.integration_select:
        class: %oro_mailchimp.form.type.integration_select.class%
        arguments:
            - "@doctrine"
            - "@oro_security.acl_helper"
        tags:
            - { name: form.type, alias: "oro_mailchimp_integration_select" }

    oro_mailchimp.form.type.template_select:
        class: %oro_mailchimp.form.type.template_select.class%
        tags:
            - { name: form.type, alias: "oro_mailchimp_template_select" }

    oro_mailchimp.form.type.list_select:
        class: %oro_mailchimp.form.type.list_select.class%
        tags:
            - { name: form.type, alias: "oro_mailchimp_list_select" }

    oro_mailchimp.form.type.transport_settings:
        class: %oro_mailchimp.form.type.transport_settings.class%
        tags:
            - { name: form.type, alias: "oro_mailchimp_email_transport_settings" }

    oro_mailchimp.form.type.marketing_list_connecion:
        class: %oro_mailchimp.form.type.marketing_list_connecion.class%
        tags:
            - { name: form.type, alias: "oro_mailchimp_marketing_list_connection" }

    oro_mailchimp.form.type.static_segment_sync_mode:
        class: %oro_mailchimp.form.type.static_segment_sync_mode.class%
        arguments:
            - '@oro_mailchimp.provider.static_segment_sync_mode_choices'
        tags:
            - { name: form.type }

    oro_mailchimp.form.autocomplete.template.search_handler:
        class: %oro_mailchimp.form.autocomplete.template.search_handler.class%
        arguments:
            - %oro_mailchimp.entity.template.class%
            - ["name"]
        calls:
            - [initDoctrinePropertiesByManagerRegistry, ["@doctrine"]]
            - [setAclHelper,["@oro_security.acl_helper"]]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: "mailchimp_templates", acl_resource: "oro_email_campaign_view" }

    oro_mailchimp.form.autocomplete.list.search_handler:
        class: %oro_mailchimp.form.autocomplete.list.search_handler.class%
        arguments:
            - %oro_mailchimp.entity.subscribers_list.class%
            - ["name"]
        calls:
            - [initDoctrinePropertiesByManagerRegistry, ["@doctrine"]]
            - [setAclHelper,["@oro_security.acl_helper"]]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: "mailchimp_lists", acl_resource: "oro_email_campaign_view" }

    # Integration related services
    oro_mailchimp.provider.channel_type:
            class: %oro_mailchimp.provider.channel_type.class%
            tags:
                - { name: oro_integration.channel, type: mailchimp }

    oro_mailchimp.transport.integration_transport:
        class: %oro_mailchimp.transport.integration_transport.class%
        arguments:
            - "@oro_mailchimp.client.factory"
            - "@doctrine"
        calls:
            - [setLogger, ["@oro_integration.logger.strategy"]]
        tags:
            - { name: oro_integration.transport, type: mailchimp_api, channel_type: mailchimp }

    # Connectors
    oro_mailchimp.connector.abstract:
        abstract: true
        arguments:
            - "@oro_importexport.context_registry"
            - "@oro_integration.logger.strategy"
            - "@oro_integration.provider.connector_context_mediator"
        calls:
            - [setManagerRegistry, ["@doctrine"]]

    oro_mailchimp.connector.template:
        class: %oro_mailchimp.connector.template.class%
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%oro_mailchimp.entity.template.class%]]
#        tags:
#            - { name: oro_integration.connector, type: template, channel_type: mailchimp }

    oro_mailchimp.connector.list:
        class: %oro_mailchimp.connector.list.class%
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%oro_mailchimp.entity.subscribers_list.class%]]
        tags:
            - { name: oro_integration.connector, type: list, channel_type: mailchimp }

    oro_mailchimp.connector.campaign:
        class: %oro_mailchimp.connector.campaign.class%
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%oro_mailchimp.entity.campaign.class%]]
        tags:
            - { name: oro_integration.connector, type: campaign, channel_type: mailchimp }

    oro_mailchimp.connector.static_segment:
        class: %oro_mailchimp.connector.static_segment.class%
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%oro_mailchimp.entity.static_segment.class%]]
        tags:
            - { name: oro_integration.connector, type: static_segment, channel_type: mailchimp }

    oro_mailchimp.connector.member:
        class: %oro_mailchimp.connector.member.class%
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%oro_mailchimp.entity.member.class%]]
        tags:
            - { name: oro_integration.connector, type: member, channel_type: mailchimp }

    oro_mailchimp.connector.member_activity_send:
        class: %oro_mailchimp.connector.member_activity_send.class%
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%oro_mailchimp.entity.member_activity.class%]]
        tags:
            - { name: oro_integration.connector, type: member_activity_send, channel_type: mailchimp }

    oro_mailchimp.connector.member_activity:
        class: %oro_mailchimp.connector.member_activity.class%
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%oro_mailchimp.entity.member_activity.class%]]
        tags:
            - { name: oro_integration.connector, type: member_activity, channel_type: mailchimp }

    oro_mailchimp.connector.member_activity_abuse:
        class: %oro_mailchimp.connector.member_activity_abuse.class%
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%oro_mailchimp.entity.member_activity.class%]]
        tags:
            - { name: oro_integration.connector, type: member_activity_abuse, channel_type: mailchimp }

    oro_mailchimp.connector.member_activity_unsubscribe:
        class: %oro_mailchimp.connector.member_activity_unsubscribe.class%
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, [%oro_mailchimp.entity.member_activity.class%]]
        tags:
            - { name: oro_integration.connector, type: member_activity_unsubscribe, channel_type: mailchimp }

    # Data Converter
    oro_mailchimp.importexport.data_converter.campaign:
        class: %oro_mailchimp.importexport.data_converter.campaign.class%

    oro_mailchimp.importexport.data_converter.template:
        class: %oro_mailchimp.importexport.data_converter.template.class%

    oro_mailchimp.importexport.data_converter.list:
        class: %oro_mailchimp.importexport.data_converter.list.class%

    oro_mailchimp.importexport.data_converter.member:
        class: %oro_mailchimp.importexport.data_converter.member.class%

    oro_mailchimp.importexport.data_converter.member_activity:
        class: %oro_mailchimp.importexport.data_converter.member_activity.class%

    oro_mailchimp.importexport.data_converter.member_activity_send:
        class: %oro_mailchimp.importexport.data_converter.member_activity_send.class%

    oro_mailchimp.importexport.data_converter.member_activity_abuse:
        class: %oro_mailchimp.importexport.data_converter.member_activity_abuse.class%

    oro_mailchimp.importexport.data_converter.member_activity_unsubscribe:
        class: %oro_mailchimp.importexport.data_converter.member_activity_unsubscribe.class%

    oro_mailchimp.importexport.data_converter.static_segment:
        class: %oro_mailchimp.importexport.data_converter.static_segment.class%

    oro_mailchimp.importexport.data_converter.extended_merge_var:
        class: %oro_mailchimp.importexport.data_converter.extended_merge_var.class%

    oro_mailchimp.importexport.data_converter.member_extended_merge_var:
        class: %oro_mailchimp.importexport.data_converter.member_extended_merge_var.class%

    # Strategy
    oro_mailchimp.importexport.strategy.abstract.add_or_replace:
        class: %oro_mailchimp.importexport.strategy.abstract.class%
        parent: oro_importexport.strategy.configurable_add_or_replace
        absract: true
        calls:
            - [setLogger, ["@oro_integration.logger.strategy"]]
            - [setOwnerHelper, ["@oro_integration.helper.default_owner_helper"]]

    oro_mailchimp.importexport.strategy.template.add_or_replace:
        class: %oro_mailchimp.importexport.strategy.template.class%
        parent: oro_mailchimp.importexport.strategy.abstract.add_or_replace

    oro_mailchimp.importexport.strategy.list:
        class: %oro_mailchimp.importexport.strategy.list.class%
        parent: oro_mailchimp.importexport.strategy.abstract.add_or_replace

    oro_mailchimp.importexport.strategy.member:
        class: %oro_mailchimp.importexport.strategy.member.class%
        parent: oro_mailchimp.importexport.strategy.abstract.add_or_replace
        calls:
            - [setMergeVarProvider, ["@oro_mailchimp.merge_var.provider"]]

    oro_mailchimp.importexport.strategy.member_activity:
        class: %oro_mailchimp.importexport.strategy.member_activity.class%
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setLogger, ["@oro_integration.logger.strategy"]]

    oro_mailchimp.importexport.strategy.campaign:
        class: %oro_mailchimp.importexport.strategy.campaign.class%
        parent: oro_mailchimp.importexport.strategy.abstract.add_or_replace

    oro_mailchimp.importexport.strategy.static_segment:
        class: %oro_mailchimp.importexport.strategy.static_segment.class%
        parent: oro_mailchimp.importexport.strategy.abstract.add_or_replace

    oro_mailchimp.importexport.strategy.export_member:
        class: %oro_mailchimp.importexport.strategy.export_member.class%
        arguments:
            - "@event_dispatcher"
            - "@oro_importexport.strategy.import.helper"
            - "@oro_entity.helper.field_helper"
            - "@oro_importexport.field.database_helper"
        calls:
            - [setEntityName, [%oro_mailchimp.entity.member.class%]]
            - [setLogger, ["@oro_integration.logger.strategy"]]

    oro_mailchimp.importexport.strategy.export_static_segment:
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setEntityName, [%oro_mailchimp.entity.static_segment_member.class%]]

    oro_mailchimp.importexport.strategy.extended_merge_var:
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setEntityName, [%oro_mailchimp.entity.extended_merge_var.class%]]

    oro_mailchimp.importexport.strategy.member_extended_merge_var:
        class: %oro_mailchimp.importexport.strategy.memeber_extended_merge_var.class%
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setEntityName, [%oro_mailchimp.entity.member_extended_merge_var.class%]]

    oro_mailchimp.importexport.strategy.export_member_extended_merge_var:
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setEntityName, [%oro_mailchimp.entity.member_extended_merge_var.class%]]

    # Import Processors
    oro_mailchimp.importexport.processor.import_abstract:
        parent: oro_importexport.processor.import_abstract
        abstract: true
        calls:
            - [setContextRegistry, ["@oro_importexport.context_registry"]]

    oro_mailchimp.importexport.processor.campaign:
        class: %oro_mailchimp.importexport.processor.import.class%
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.campaign"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.campaign"]]
            - [setEntityName, [%oro_mailchimp.entity.campaign.class%]]

    oro_mailchimp.importexport.processor.list:
        class: %oro_mailchimp.importexport.processor.import.class%
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.list"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.list"]]
            - [setEntityName, [%oro_mailchimp.entity.subscribers_list.class%]]

    oro_mailchimp.importexport.processor.member:
        class: %oro_mailchimp.importexport.processor.import.class%
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.member"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.member"]]
            - [setEntityName, [%oro_mailchimp.entity.member.class%]]

    oro_mailchimp.importexport.processor.member_activity:
        class: %oro_mailchimp.importexport.processor.import.class%
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.member_activity"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.member_activity"]]
            - [setEntityName, [%oro_mailchimp.entity.member_activity.class%]]

    oro_mailchimp.importexport.processor.member_activity_send:
        class: %oro_mailchimp.importexport.processor.import.class%
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.member_activity_send"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.member_activity"]]
            - [setEntityName, [%oro_mailchimp.entity.member_activity.class%]]

    oro_mailchimp.importexport.processor.member_activity_abuse:
        class: %oro_mailchimp.importexport.processor.import.class%
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.member_activity_abuse"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.member_activity"]]
            - [setEntityName, [%oro_mailchimp.entity.member_activity.class%]]

    oro_mailchimp.importexport.processor.member_activity_unsubscribe:
        class: %oro_mailchimp.importexport.processor.import.class%
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.member_activity_unsubscribe"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.member_activity"]]
            - [setEntityName, [%oro_mailchimp.entity.member_activity.class%]]

    oro_mailchimp.importexport.processor.template:
        class: %oro_mailchimp.importexport.processor.import.class%
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.template"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.template.add_or_replace"]]
            - [setEntityName, [%oro_mailchimp.entity.template.class%]]

    oro_mailchimp.importexport.processor.static_segment:
        class: %oro_mailchimp.importexport.processor.import.class%
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.static_segment"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.static_segment"]]
            - [setEntityName, [%oro_mailchimp.entity.static_segment.class%]]

    oro_mailchimp.importexport.processor.remove.abstract:
        class: %oro_mailchimp.importexport.processor.remove.class%
        abstract: true
        arguments:
            - "@oro_importexport.context_registry"
            - "@oro_entity.doctrine_helper"

    oro_mailchimp.importexport.processor.template.remove:
        parent: oro_mailchimp.importexport.processor.remove.abstract
        calls:
            - [setEntityName, [%oro_mailchimp.entity.template.class%]]
            - [setSearchField, ['originId']]

    oro_mailchimp.importexport.processor.list.remove:
        parent: oro_mailchimp.importexport.processor.remove.abstract
        calls:
            - [setEntityName, [%oro_mailchimp.entity.subscribers_list.class%]]
            - [setSearchField, ['originId']]

    oro_mailchimp.importexport.processor.campaign.remove:
        class: %oro_mailchimp.importexport.processor.campaign_remove.class%
        parent: oro_mailchimp.importexport.processor.remove.abstract
        calls:
            - [setEntityName, [%oro_mailchimp.entity.campaign.class%]]
            - [setSearchField, ['originId']]
            - [setCampaignType, ['regular']]

    oro_mailchimp.importexport.processor.dummy:
        class: %oro_mailchimp.importexport.processor.dummy.class%

    oro_mailchimp.importexport.processor.extended_merge_var:
        class: %oro_mailchimp.importexport.processor.import.class%
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.extended_merge_var"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.extended_merge_var"]]
            - [setEntityName, [%oro_mailchimp.entity.extended_merge_var.class%]]

    oro_mailchimp.importexport.processor.member_extended_merge_var:
        class: %oro_mailchimp.importexport.processor.import.class%
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.member_extended_merge_var"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.member_extended_merge_var"]]
            - [setEntityName, [%oro_mailchimp.entity.member_extended_merge_var.class%]]

    # Export Processors
    oro_mailchimp.importexport.processor.export_member:
        class: %oro_mailchimp.importexport.processor.export_member.class%
        parent: oro_importexport.processor.export_abstract
        calls:
            - [setContextRegistry, ["@oro_importexport.context_registry"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.export_member"]]

    oro_mailchimp.importexport.processor.export_static_segment:
        class: %oro_mailchimp.importexport.processor.export_static_segment.class%
        parent: oro_importexport.processor.export_abstract
        calls:
            - [setContextRegistry, ["@oro_importexport.context_registry"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.export_static_segment"]]

    oro_mailchimp.importexport.processor.export_extended_merge_var:
        class: %oro_mailchimp.importexport.processor.export_static_segment.class%
        parent: oro_importexport.processor.export_abstract
        calls:
            - [setContextRegistry, ["@oro_importexport.context_registry"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.extended_merge_var"]]

    oro_mailchimp.importexport.processor.export_member_extended_merge_var:
        class: %oro_mailchimp.importexport.processor.export_static_segment.class%
        parent: oro_importexport.processor.export_abstract
        calls:
            - [setContextRegistry, ["@oro_importexport.context_registry"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.export_member_extended_merge_var"]]

    # MergeVar related services
    oro_mailchimp.merge_var.provider:
        class: %oro_mailchimp.merge_var.provider.class%

    # Workflow actions and conditions
    oro_mailchimp.workflow.action.abstract_marketing_list_entities:
        class: %oro_mailchimp.workflow.action.abstract_marketing_list_entities.class%
        astract: true
        arguments:
            - "@oro_action.expression.context_accessor"
            - "@oro_marketing_list.provider.contact_information_fields"
            - "@oro_marketing_list.provider.marketing_list"
            - "@oro_mailchimp.model.field_helper"

    oro_mailchimp.workflow.action.update_email_campaign_statistics:
        class: %oro_mailchimp.workflow.action.update_email_campaign_statistics.class%
        parent: oro_mailchimp.workflow.action.abstract_marketing_list_entities
        calls:
            - [setCampaignStatisticsConnector, ["@oro_campaign.email_campaign.statistics_connector"]]
            - [setRegistry, ["@doctrine"]]
        tags:
            - { name: oro_action.action, alias: update_email_campaign_statistics }

    oro_mailchimp.workflow.action.create_marketing_list_state_item:
        parent: oro_mailchimp.workflow.action.abstract_marketing_list_entities
        calls:
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]

    oro_mailchimp.workflow.action.create_marketing_list_unsubscribed_item:
        class: %oro_mailchimp.workflow.action.create_marketing_list_state_item.class%
        parent: oro_mailchimp.workflow.action.create_marketing_list_state_item
        calls:
            - [setMarketingListStateItemClassName, [%oro_marketing_list.unsubscribed_item.class%]]
        tags:
            - { name: oro_action.action, alias: create_marketing_list_unsubscribed_item }

    oro_mailchimp.email_campaign.security.acl.voter.entity:
        class: %oro_mailchimp.email_campaign.security.acl.voter.entity.class%
        arguments:
            - "@oro_entity.doctrine_helper"
        calls:
            - [setClassName, [%oro_campaign.email_campaign.entity.class%]]
        tags:
            - { name: security.voter, priority: 500 }

    oro_mailchimp.acl.voter.marketing_list_state_item:
        class: %oro_mailchimp.acl.voter.marketing_list_state_item.class%
        arguments:
            - "@oro_entity.doctrine_helper"
            - "@oro_marketing_list.provider.contact_information_fields"
            - "@oro_mailchimp.model.field_helper"
            - %oro_mailchimp.entity.member.class%
            - %oro_mailchimp.entity.subscribers_list.class%
            - %oro_marketing_list.entity.class%
        calls:
            - [setClassName, [%oro_marketing_list.unsubscribed_item.class%]]
        tags:
            - { name: security.voter, priority: 500 }

    oro_mailchimp.static_segment_manager.state_manager:
        class: %oro_mailchimp.static_segment_manager.state_manager.class%
        arguments:
            - "@oro_entity.doctrine_helper"
            - %oro_mailchimp.entity.static_segment_member.class%
            - %oro_mailchimp.entity.member.class%
            - %oro_mailchimp.entity.member_extended_merge_var.class%

    # Iterators
    oro_mailchimp.iterator.static_segment:
        class: %oro_mailchimp.iterator.static_segment.class%
        abstract: true
        arguments:
            - "@oro_marketing_list.provider.marketing_list"
            - "@oro_security.owner.ownership_metadata_provider"
            - %oro_marketing_list.removed_item.class%
            - %oro_marketing_list.unsubscribed_item.class%
        calls:
            - [setSegmentMemberClassName, [%oro_mailchimp.entity.static_segment_member.class%]]

    oro_mailchimp.iterator.static_segment_members.abstract:
        class: %oro_mailchimp.iterator.static_segment_members.abstract.class%
        parent: oro_mailchimp.iterator.static_segment
        abstract: true
        calls:
            - [setContactInformationFieldsProvider, ["@oro_marketing_list.provider.contact_information_fields"]]
            - [setFieldHelper, ["@oro_mailchimp.model.field_helper"]]
            - [setMemberClassName, [%oro_mailchimp.entity.member.class%]]

    oro_mailchimp.iterator.marketing_list_email:
        class: %oro_mailchimp.iterator.marketing_list_email.class%
        parent: oro_mailchimp.iterator.static_segment
        calls:
            - [setContactInformationFieldsProvider, ["@oro_marketing_list.provider.contact_information_fields"]]
            - [setFieldHelper, ["@oro_mailchimp.model.field_helper"]]

    oro_mailchimp.iterator.member_sync:
        class: %oro_mailchimp.iterator.member_sync.class%
        parent: oro_mailchimp.iterator.static_segment_members.abstract
        calls:
            - [setFormatter, ["@oro_locale.dql.formatter.name"]]
            - [setMergeVarsProvider, ["@oro_mailchimp.merge_var.provider"]]
            - [setExtendMergeVarsClass, [%oro_mailchimp.entity.extended_merge_var.class%]]

    oro_mailchimp.iterator.static_segment_member_add_state:
        class: %oro_mailchimp.iterator.static_segment_member_add_state.class%
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setMarketingListEmailEntity, [%oro_mailchimp.entity.marketing_list_email.class%]]
            - [setMemberEntity, [%oro_mailchimp.entity.member.class%]]

    oro_mailchimp.iterator.static_segment_member_remove_state:
        class: %oro_mailchimp.iterator.static_segment_member_remove_state.class%
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setMarketingListEmailEntity, [%oro_mailchimp.entity.marketing_list_email.class%]]
            - [setMemberEntity, [%oro_mailchimp.entity.member.class%]]

    oro_mailchimp.iterator.static_segment_member_dropped_state:
        class: %oro_mailchimp.iterator.static_segment_member_dropped_state.class%
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setMemberExtendedMergeVarEntity, [%oro_mailchimp.entity.member_extended_merge_var.class%]]
            - [setMemberEntity, [%oro_mailchimp.entity.member.class%]]

    oro_mailchimp.iterator.static_segment_member_remove_by_state:
        class: %oro_mailchimp.iterator.static_segment_member_to_remove.class%
        abstract: true
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setMemberToRemoveEntity, [%oro_mailchimp.entity.static_segment_member_to_remove.class%]]

    oro_mailchimp.iterator.static_segment_member_out_of_list:
        parent: oro_mailchimp.iterator.static_segment_member_remove_by_state
        calls:
            - [setState, ['remove']]

    oro_mailchimp.iterator.static_segment_member_unsubscribe_state:
        parent: oro_mailchimp.iterator.static_segment_member_remove_by_state
        calls:
            - [setState, ['unsubscribe']]

    oro_mailchimp.iterator.static_segment_member_unsubscribe_delete_state:
        parent: oro_mailchimp.iterator.static_segment_member_remove_by_state
        calls:
            - [setState, ['unsubscribe_delete']]

    oro_mailchimp.iterator.extended_merge_var_add:
        class: %oro_mailchimp.iterator.extended_merge_var_add.class%
        arguments:
            - "@oro_mailchimp.extended_merge_var.filtered_provider"

    oro_mailchimp.iterator.extended_merge_var_remove:
        class: %oro_mailchimp.iterator.extended_merge_var_remove.class%
        arguments:
            - "@oro_entity.doctrine_helper"
            - "@oro_mailchimp.extended_merge_var.filtered_provider"
            - %oro_mailchimp.entity.extended_merge_var.class%

    oro_mailchimp.iterator.mmbr_extd_merge_var:
        class: %oro_mailchimp.iterator.mmbr_extd_merge_var.class%
        parent: oro_mailchimp.iterator.static_segment_members.abstract
        calls:
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]
            - [setExtendMergeVarsProvider, ["@oro_mailchimp.extended_merge_var.filtered_provider"]]

    # Placeholder
    oro_mailchimp.placeholder.filter.sync_status:
        class: %oro_mailchimp.placeholder.filter.marketing_list.class%
        arguments:
            - "@doctrine"

    oro_mailchimp.placeholder.filter.email_campaign:
        class: %oro_mailchimp.placeholder.filter.email_campaign.class%
        arguments:
            - "@doctrine"

    oro_mailchimp.segment.column_definition.factory:
        class: %oro_mailchimp.segment.column_definition.factory.class%

    oro_mailchimp.extended_merge_var.composite_provider:
        class: %oro_mailchimp.extended_merge_var.composite_provider.class%

    oro_mailchimp.extended_merge_var.filtered_provider:
        class: Oro\Bundle\MailChimpBundle\Model\ExtendedMergeVar\FilteredMergeVarsProvider
        arguments:
          - '@oro_mailchimp.extended_merge_var.composite_provider'
          - '@oro_locale.dql.formatter.name'
          - '@oro_marketing_list.provider.contact_information_fields'

    oro_mailchimp.marketinglist.datagrid_provider:
        class: %oro_mailchimp.marketinglist.datagrid_provider.class%
        parent: oro_marketing_list.provider.marketing_list

    oro_mailchimp.async.export_mailchimp_processor:
        class: 'Oro\Bundle\MailChimpBundle\Async\ExportMailChimpProcessor'
        arguments:
            - '@oro_entity.doctrine_helper'
            - '@oro_integration.reverse_sync.processor'
            - '@oro_mailchimp.static_segment_manager.state_manager'
            - '@oro_message_queue.job.runner'
            - '@security.token_storage'
            - '@logger'
        tags:
            - { name: 'oro_message_queue.client.message_processor' }

    oro_mailchimp.marketing_list_extend_merge_var_provider:
        class: Oro\Bundle\MailChimpBundle\Provider\MarketingListExtendedMergeVarProvider
        arguments:
            - '@oro_entity.entity_field_provider'
        tags:
            - { name: oro_mailchimp.extended_merge_vars.provider }

    oro_mailchimp.listener.notify_mailchimp:
        class: Oro\Bundle\MailChimpBundle\EventListener\NotifyMailChimpListener
        arguments:
            - '@oro_entity.doctrine_helper'
        tags:
            - { name: kernel.event_listener, event: oro_marketing_list.event.update_marketing_list, method: onMarketingListChange }

    oro_mailchimp.entity.entity_listener.channel_listener:
        class: 'Oro\Bundle\MailChimpBundle\Entity\EntityListener\ChannelListener'
        public: false
        arguments:
            - "@doctrine"
        tags:
            - { name: doctrine.orm.entity_listener, entity: '%oro_integration.entity.class%', event: preRemove }

    oro_mailchimp.provider.static_segment_sync_mode_choices:
        class: 'Oro\Bundle\MailChimpBundle\Provider\StaticSegmentSyncModeChoicesProvider'
        arguments:
            - '@oro_entity.doctrine_helper'
            - '@translator'
