!function(a,b){if("function"==typeof define&&define.amd)define(["backbone","underscore"],b);else if("object"==typeof module&&module&&module.exports)module.exports=b(require("backbone"),require("underscore"));else{if("function"!=typeof require)throw new Error("Chaplin requires Common.js or AMD modules");b(window.Backbone,window._||window.Backbone.utils)}}(this,function(a,b){function c(c){return{backbone:a,underscore:b}[c]}return(c=function d(a,b,e){function f(h,i){if(!b[h]){if(!a[h]){var j="function"==typeof c&&c;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var l=b[h]={exports:{}};a[h][0].call(l.exports,function(b){var c=a[h][1][b];return f(c?c:b)},l,l.exports,d,a,b,e)}return b[h].exports}for(var g="function"==typeof c&&c,h=0;h<e.length;h++)f(e[h]);return f}({1:[function(a,b,c){"use strict";b.exports={Application:a("./chaplin/application"),Composer:a("./chaplin/composer"),Controller:a("./chaplin/controllers/controller"),Dispatcher:a("./chaplin/dispatcher"),Composition:a("./chaplin/lib/composition"),EventBroker:a("./chaplin/lib/event_broker"),History:a("./chaplin/lib/history"),Route:a("./chaplin/lib/route"),Router:a("./chaplin/lib/router"),support:a("./chaplin/lib/support"),SyncMachine:a("./chaplin/lib/sync_machine"),utils:a("./chaplin/lib/utils"),mediator:a("./chaplin/mediator"),Collection:a("./chaplin/models/collection"),Model:a("./chaplin/models/model"),CollectionView:a("./chaplin/views/collection_view"),Layout:a("./chaplin/views/layout"),View:a("./chaplin/views/view")}},{"./chaplin/application":2,"./chaplin/composer":3,"./chaplin/controllers/controller":4,"./chaplin/dispatcher":5,"./chaplin/lib/composition":6,"./chaplin/lib/event_broker":7,"./chaplin/lib/history":8,"./chaplin/lib/route":9,"./chaplin/lib/router":10,"./chaplin/lib/support":11,"./chaplin/lib/sync_machine":12,"./chaplin/lib/utils":13,"./chaplin/mediator":14,"./chaplin/models/collection":15,"./chaplin/models/model":16,"./chaplin/views/collection_view":17,"./chaplin/views/layout":18,"./chaplin/views/view":19}],2:[function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l;k=a("underscore"),e=a("backbone"),f=a("./composer"),g=a("./dispatcher"),j=a("./lib/router"),i=a("./views/layout"),h=a("./lib/event_broker"),l=a("./mediator"),b.exports=d=function(){function a(a){null==a&&(a={}),this.initialize(a)}return a.extend=e.Model.extend,k.extend(a.prototype,h),a.prototype.title="",a.prototype.dispatcher=null,a.prototype.layout=null,a.prototype.router=null,a.prototype.composer=null,a.prototype.started=!1,a.prototype.initialize=function(a){if(null==a&&(a={}),this.started)throw new Error("Application#initialize: App was already started");return this.initRouter(a.routes,a),this.initDispatcher(a),this.initLayout(a),this.initComposer(a),this.initMediator(),this.start()},a.prototype.initDispatcher=function(a){return this.dispatcher=new g(a)},a.prototype.initLayout=function(a){return null==a&&(a={}),null==a.title&&(a.title=this.title),this.layout=new i(a)},a.prototype.initComposer=function(a){return null==a&&(a={}),this.composer=new f(a)},a.prototype.initMediator=function(){return Object.seal(l)},a.prototype.initRouter=function(a,b){return this.router=new j(b),"function"==typeof a?a(this.router.match):void 0},a.prototype.start=function(){return this.router.startHistory(),this.started=!0,this.disposed=!1,Object.seal(this)},a.prototype.dispose=function(){var a,b,c,d;if(!this.disposed){for(d=["dispatcher","layout","router","composer"],a=0,b=d.length;a<b;a++)c=d[a],null!=this[c]&&this[c].dispose();return this.disposed=!0,Object.freeze(this)}},a}()},{"./composer":3,"./dispatcher":5,"./lib/event_broker":7,"./lib/router":10,"./mediator":14,"./views/layout":18,backbone:"backbone",underscore:"underscore"}],3:[function(a,b,c){"use strict";var d,e,f,g,h,i;h=a("underscore"),d=a("backbone"),f=a("./lib/composition"),g=a("./lib/event_broker"),i=a("./mediator"),b.exports=e=function(){function a(){this.initialize.apply(this,arguments)}return a.extend=d.Model.extend,h.extend(a.prototype,g),a.prototype.compositions=null,a.prototype.initialize=function(a){return null==a&&(a={}),this.compositions={},i.setHandler("composer:compose",this.compose,this),i.setHandler("composer:retrieve",this.retrieve,this),this.subscribeEvent("dispatcher:dispatch",this.cleanup)},a.prototype.compose=function(a,b,c){return"function"==typeof b?c||b.prototype.dispose?b.prototype instanceof f?this._compose(a,{composition:b,options:c}):this._compose(a,{options:c,compose:function(){var a,c;if(b.prototype instanceof d.Model||b.prototype instanceof d.Collection?this.item=new b(null,this.options):this.item=new b(this.options),a=this.item.autoRender,c=void 0===a||!a,c&&"function"==typeof this.item.render)return this.item.render()}}):this._compose(a,{compose:b}):"function"==typeof c?this._compose(a,{compose:c,options:b}):this._compose(a,b)},a.prototype._compose=function(a,b){var c,d,e,g;if("function"!=typeof b.compose&&null==b.composition)throw new Error("Composer#compose was used incorrectly");return null!=b.composition?c=new b.composition(b.options):(c=new f(b.options),c.compose=b.compose,b.check&&(c.check=b.check)),d=this.compositions[a],d&&d.check(c.options)?d.stale(!1):(d&&d.dispose(),g=c.compose(c.options),e="function"==typeof(null!=g?g.then:void 0),c.stale(!1),this.compositions[a]=c),e?g:this.compositions[a].item},a.prototype.retrieve=function(a){var b;if(b=this.compositions[a],b&&!b.stale())return b.item},a.prototype.cleanup=function(){var a,b,c,d,e;for(e=Object.keys(this.compositions),b=0,d=e.length;b<d;b++)c=e[b],a=this.compositions[c],a.stale()?(a.dispose(),delete this.compositions[c]):a.stale(!0)},a.prototype.disposed=!1,a.prototype.dispose=function(){var a,b,c,d;if(!this.disposed){for(this.unsubscribeAllEvents(),i.removeHandlers(this),d=Object.keys(this.compositions),a=0,c=d.length;a<c;a++)b=d[a],this.compositions[b].dispose();return delete this.compositions,this.disposed=!0,Object.freeze(this)}},a}()},{"./lib/composition":6,"./lib/event_broker":7,"./mediator":14,backbone:"backbone",underscore:"underscore"}],4:[function(a,b,c){"use strict";var d,e,f,g,h,i,j=[].slice;g=a("underscore"),d=a("backbone"),h=a("../mediator"),f=a("../lib/event_broker"),i=a("../lib/utils"),b.exports=e=function(){function a(){this.initialize.apply(this,arguments)}return a.extend=d.Model.extend,g.extend(a.prototype,d.Events),g.extend(a.prototype,f),a.prototype.view=null,a.prototype.redirected=!1,a.prototype.initialize=function(){},a.prototype.beforeAction=function(){},a.prototype.adjustTitle=function(a){return h.execute("adjustTitle",a)},a.prototype.reuse=function(){var a;return a=1===arguments.length?"retrieve":"compose",h.execute.apply(h,["composer:"+a].concat(j.call(arguments)))},a.prototype.compose=function(){throw new Error("Controller#compose was moved to Controller#reuse")},a.prototype.redirectTo=function(){return this.redirected=!0,i.redirectTo.apply(i,arguments)},a.prototype.disposed=!1,a.prototype.dispose=function(){var a,b,c,d,e;if(!this.disposed){for(e=Object.keys(this),a=0,c=e.length;a<c;a++)b=e[a],d=this[b],"function"==typeof(null!=d?d.dispose:void 0)&&(d.dispose(),delete this[b]);return this.unsubscribeAllEvents(),this.stopListening(),this.disposed=!0,Object.freeze(this)}},a}()},{"../lib/event_broker":7,"../lib/utils":13,"../mediator":14,backbone:"backbone",underscore:"underscore"}],5:[function(a,b,c){"use strict";var d,e,f,g,h,i;g=a("underscore"),d=a("backbone"),f=a("./lib/event_broker"),i=a("./lib/utils"),h=a("./mediator"),b.exports=e=function(){function a(){this.initialize.apply(this,arguments)}return a.extend=d.Model.extend,g.extend(a.prototype,f),a.prototype.previousRoute=null,a.prototype.currentController=null,a.prototype.currentRoute=null,a.prototype.currentParams=null,a.prototype.currentQuery=null,a.prototype.initialize=function(a){return null==a&&(a={}),this.settings=g.defaults(a,{controllerPath:"controllers/",controllerSuffix:"_controller"}),this.subscribeEvent("router:match",this.dispatch)},a.prototype.dispatch=function(a,b,c){var d,e;if(b=g.extend({},b),c=g.extend({},c),null==c.query&&(c.query={}),c.forceStartup!==!0&&(c.forceStartup=!1),c.forceStartup||(null!=(d=this.currentRoute)?d.controller:void 0)!==a.controller||(null!=(e=this.currentRoute)?e.action:void 0)!==a.action||!g.isEqual(this.currentParams,b)||!g.isEqual(this.currentQuery,c.query))return this.loadController(a.controller,function(d){return function(e){return d.controllerLoaded(a,b,c,e)}}(this))},a.prototype.loadController=function(a,b){var c,d;return a===Object(a)?b(a):(c=a+this.settings.controllerSuffix,d=this.settings.controllerPath+c,i.loadModule(d,b))},a.prototype.controllerLoaded=function(a,b,c,d){var e,f,h;return(this.nextPreviousRoute=this.currentRoute)&&(h=g.extend({},this.nextPreviousRoute),null!=this.currentParams&&(h.params=this.currentParams),h.previous&&delete h.previous,f={previous:h}),this.nextCurrentRoute=g.extend({},a,f),e=new d(b,this.nextCurrentRoute,c),this.executeBeforeAction(e,this.nextCurrentRoute,b,c)},a.prototype.executeAction=function(a,b,c,d){if(this.currentController&&(this.publishEvent("beforeControllerDispose",this.currentController),this.currentController.dispose(c,b,d)),this.currentController=a,this.currentParams=g.extend({},c),this.currentQuery=g.extend({},d.query),a[b.action](c,b,d),!a.redirected)return this.publishEvent("dispatcher:dispatch",this.currentController,c,b,d)},a.prototype.executeBeforeAction=function(a,b,c,d){var e,f,g;if(e=a.beforeAction,f=function(e){return function(){return a.redirected||e.currentRoute&&b===e.currentRoute?(e.nextPreviousRoute=e.nextCurrentRoute=null,void a.dispose()):(e.previousRoute=e.nextPreviousRoute,e.currentRoute=e.nextCurrentRoute,e.nextPreviousRoute=e.nextCurrentRoute=null,e.executeAction(a,b,c,d))}}(this),!e)return void f();if("function"!=typeof e)throw new TypeError("Controller#beforeAction: function expected. Old object-like form is not supported.");return g=a.beforeAction(c,b,d),"function"==typeof(null!=g?g.then:void 0)?g.then(f):f()},a.prototype.disposed=!1,a.prototype.dispose=function(){if(!this.disposed)return this.unsubscribeAllEvents(),this.disposed=!0,Object.freeze(this)},a}()},{"./lib/event_broker":7,"./lib/utils":13,"./mediator":14,backbone:"backbone",underscore:"underscore"}],6:[function(a,b,c){"use strict";var d,e,f,g;g=a("underscore"),d=a("backbone"),f=a("./event_broker"),b.exports=e=function(){function a(a){this.options=g.extend({},a),this.item=this,this.initialize(this.options)}return a.extend=d.Model.extend,g.extend(a.prototype,d.Events),g.extend(a.prototype,f),a.prototype.item=null,a.prototype.options=null,a.prototype._stale=!1,a.prototype.initialize=function(){},a.prototype.compose=function(){},a.prototype.check=function(a){return g.isEqual(this.options,a)},a.prototype.stale=function(a){var b,c;if(null==a)return this._stale;this._stale=a;for(c in this)b=this[c],b&&b!==this&&"object"==typeof b&&b.hasOwnProperty("stale")&&(b.stale=a)},a.prototype.disposed=!1,a.prototype.dispose=function(){var a,b,c,d,e;if(!this.disposed){for(e=Object.keys(this),a=0,c=e.length;a<c;a++)b=e[a],d=this[b],d&&d!==this&&"function"==typeof d.dispose&&(d.dispose(),delete this[b]);return this.unsubscribeAllEvents(),this.stopListening(),delete this.redirected,this.disposed=!0,Object.freeze(this)}},a}()},{"./event_broker":7,backbone:"backbone",underscore:"underscore"}],7:[function(a,b,c){"use strict";var d,e,f=[].slice;e=a("../mediator"),d={subscribeEvent:function(a,b){if("string"!=typeof a)throw new TypeError("EventBroker#subscribeEvent: type argument must be a string");if("function"!=typeof b)throw new TypeError("EventBroker#subscribeEvent: handler argument must be a function");return e.unsubscribe(a,b,this),e.subscribe(a,b,this)},subscribeEventOnce:function(a,b){if("string"!=typeof a)throw new TypeError("EventBroker#subscribeEventOnce: type argument must be a string");if("function"!=typeof b)throw new TypeError("EventBroker#subscribeEventOnce: handler argument must be a function");return e.unsubscribe(a,b,this),e.subscribeOnce(a,b,this)},unsubscribeEvent:function(a,b){if("string"!=typeof a)throw new TypeError("EventBroker#unsubscribeEvent: type argument must be a string");if("function"!=typeof b)throw new TypeError("EventBroker#unsubscribeEvent: handler argument must be a function");return e.unsubscribe(a,b)},unsubscribeAllEvents:function(){return e.unsubscribe(null,null,this)},publishEvent:function(){var a,b;if(b=arguments[0],a=2<=arguments.length?f.call(arguments,1):[],"string"!=typeof b)throw new TypeError("EventBroker#publishEvent: type argument must be a string");return e.publish.apply(e,[b].concat(f.call(a)))}},Object.freeze(d),b.exports=d},{"../mediator":14}],8:[function(a,b,c){"use strict";var d,e,f,g,h,i=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},j={}.hasOwnProperty;f=a("underscore"),d=a("backbone"),h=/^[#\/]|\s+$/g,g=/^\/+|\/+$/g,e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return i(b,a),b.prototype.getFragment=function(a,b){var c;return null==a&&(this._hasPushState||!this._wantsHashChange||b?(a=this.location.pathname+this.location.search,c=this.root.replace(/\/$/,""),a.indexOf(c)||(a=a.slice(c.length))):a=this.getHash()),a.replace(h,"")},b.prototype.start=function(a){var b,c,e,i,j,k;if(d.History.started)throw new Error("Backbone.history has already been started");return d.History.started=!0,this.options=f.extend({},{root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=Boolean(this.options.pushState),this._hasPushState=Boolean(this.options.pushState&&(null!=(i=this.history)?i.pushState:void 0)),c=this.getFragment(),h=null!=(j=this.options.routeStripper)?j:h,g=null!=(k=this.options.rootStripper)?k:g,this.root=("/"+this.root+"/").replace(g,"/"),this._hasPushState?d.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&d.$(window).on("hashchange",this.checkUrl),this.fragment=c,e=this.location,b=e.pathname.replace(/[^\/]$/,"$&/")===this.root,this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&b&&e.hash&&(this.fragment=this.getHash().replace(h,""),this.history.replaceState({},document.title,this.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},b.prototype.navigate=function(a,b){var c,e;if(null==a&&(a=""),!d.History.started)return!1;if(b&&b!==!0||(b={trigger:b}),a=this.getFragment(a),e=this.root+a,this.fragment===a)return!1;if(this.fragment=a,0===a.length&&e!==this.root&&(e=e.slice(0,-1)),this._hasPushState)c=b.replace?"replaceState":"pushState",this.history[c]({},document.title,e);else{if(!this._wantsHashChange)return this.location.assign(e);this._updateHash(this.location,a,b.replace)}return b.trigger?this.loadUrl(a):void 0},b}(d.History),b.exports=d.$?e:d.History},{backbone:"backbone",underscore:"underscore"}],9:[function(a,b,c){"use strict";var d,e,f,g,h,i,j=function(a,b){return function(){return a.apply(b,arguments)}};h=a("underscore"),d=a("backbone"),f=a("./event_broker"),i=a("./utils"),e=a("../controllers/controller"),b.exports=g=function(){function a(a,b,c,d){if(this.pattern=a,this.controller=b,this.action=c,this.handler=j(this.handler,this),this.parseOptionalPortion=j(this.parseOptionalPortion,this),"string"!=typeof this.pattern)throw new Error("Route: RegExps are not supported. Use strings with :names and `constraints` option of route");if(this.options=h.extend({},d),this.options.paramsInQS!==!1&&(this.options.paramsInQS=!0),null!=this.options.name&&(this.name=this.options.name),this.name&&this.name.indexOf("#")!==-1)throw new Error('Route: "#" cannot be used in name');if(null==this.name&&(this.name=this.controller+"#"+this.action),this.allParams=[],this.requiredParams=[],this.optionalParams=[],this.action in e.prototype)throw new Error("Route: You should not use existing controller properties as action names");this.createRegExp(),Object.freeze(this)}var b,c,g,k;return a.extend=d.Model.extend,h.extend(a.prototype,f),b=/[\-{}\[\]+?.,\\\^$|#\s]/g,c=/\((.*?)\)/g,g=/(?::|\*)(\w+)/g,k=function(a,b){switch(b){case!0:"/"!==a.slice(-1)&&(a+="/");break;case!1:"/"===a.slice(-1)&&(a=a.slice(0,-1))}return a},a.prototype.matches=function(a){var b,c,d,e,f,g,h;if("string"==typeof a)return a===this.name;for(f=0,h=["name","action","controller"],b=0,d=h.length;b<d;b++)if(e=h[b],f++,g=a[e],g&&g!==this[e])return!1;return c=1===f&&("action"===e||"controller"===e),!c},a.prototype.reverse=function(a,b){var d,e,f,g,j,l,m,n,o,p,q;if(a=this.normalizeParams(a),o=h.extend({},a),a===!1)return!1;for(p=this.pattern,m=this.requiredParams,d=0,f=m.length;d<f;d++)j=m[d],q=a[j],p=p.replace(RegExp("[:*]"+j,"g"),q),delete o[j];for(n=this.optionalParams,e=0,g=n.length;e<g;e++)j=n[e],(q=a[j])&&(p=p.replace(RegExp("[:*]"+j,"g"),q),delete o[j]);return l=p.replace(c,function(a,b){return b.match(/[:*]/g)?"":b}),p=k(l,this.options.trailing),"object"!=typeof b&&(b=i.queryParams.parse(b)),this.options.paramsInQS!==!1&&h.extend(b,o),i.isEmpty(b)||(p+="?"+i.queryParams.stringify(b)),p},a.prototype.normalizeParams=function(a){var b,c,d,e,f,g;if(Array.isArray(a)){if(a.length<this.requiredParams.length)return!1;for(e={},g=this.requiredParams.concat(this.optionalParams),c=b=0,f=a.length-1;b<=f;c=b+=1)d=g[c],e[d]=a[c];if(!this.testConstraints(e))return!1;a=e}else if(null==a&&(a={}),!this.testParams(a))return!1;return a},a.prototype.testConstraints=function(a){var b;return b=this.options.constraints,Object.keys(b||{}).every(function(c){return b[c].test(a[c])})},a.prototype.testParams=function(a){var b,c,d,e;for(e=this.requiredParams,b=0,c=e.length;b<c;b++)if(d=e[b],void 0===a[d])return!1;return this.testConstraints(a)},a.prototype.createRegExp=function(){var a;return a=this.pattern,a=a.replace(b,"\\$&"),this.replaceParams(a,function(a){return function(b,c){return a.allParams.push(c)}}(this)),a=a.replace(c,this.parseOptionalPortion),a=this.replaceParams(a,function(a){return function(b,c){return a.requiredParams.push(c),a.paramCapturePattern(b)}}(this)),this.regExp=RegExp("^"+a+"(?=\\/*(?=\\?|$))")},a.prototype.parseOptionalPortion=function(a,b){var c;return c=this.replaceParams(b,function(a){return function(b,c){return a.optionalParams.push(c),a.paramCapturePattern(b)}}(this)),"(?:"+c+")?"},a.prototype.replaceParams=function(a,b){return a.replace(g,b)},a.prototype.paramCapturePattern=function(a){return":"===a[0]?"([^/?]+)":"(.*?)"},a.prototype.test=function(a){var b,c;return!!(c=this.regExp.test(a))&&(b=this.options.constraints,!b||this.testConstraints(this.extractParams(a)))},a.prototype.handler=function(a,b){var c,d,e,f,g,j;return b=h.extend({},b),a&&"object"==typeof a?(f=i.queryParams.stringify(b.query),d=a,e=this.reverse(d)):(g=a.split("?"),e=g[0],f=g[1],null==f?f="":b.query=i.queryParams.parse(f),d=this.extractParams(e),e=k(e,this.options.trailing)),c=h.extend({},d,this.options.params),j={path:e,action:this.action,controller:this.controller,name:this.name,query:f},this.publishEvent("router:match",j,c,b)},a.prototype.extractParams=function(a){var b,c,d,e,f,g,h,i;for(h={},f=this.regExp.exec(a),i=f.slice(1),c=b=0,d=i.length;b<d;c=++b)e=i[c],g=this.allParams.length?this.allParams[c]:c,h[g]=e;return h},a}()},{"../controllers/controller":4,"./event_broker":7,"./utils":13,backbone:"backbone",underscore:"underscore"}],10:[function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l=function(a,b){return function(){return a.apply(b,arguments)}};i=a("underscore"),d=a("backbone"),e=a("./event_broker"),f=a("./history"),g=a("./route"),k=a("./utils"),j=a("../mediator"),b.exports=h=function(){function a(a){var b;this.options=null!=a?a:{},this.match=l(this.match,this),b="file:"!==window.location.protocol,i.defaults(this.options,{pushState:b,root:"/",trailing:!1}),this.removeRoot=new RegExp("^"+k.escapeRegExp(this.options.root)+"(#)?"),this.subscribeEvent("!router:route",this.oldEventError),this.subscribeEvent("!router:routeByName",this.oldEventError),this.subscribeEvent("!router:changeURL",this.oldURLEventError),this.subscribeEvent("dispatcher:dispatch",this.changeURL),j.setHandler("router:route",this.route,this),j.setHandler("router:reverse",this.reverse,this),this.createHistory()}return a.extend=d.Model.extend,i.extend(a.prototype,e),a.prototype.oldEventError=function(){throw new Error("!router:route and !router:routeByName events were removed. Use `Chaplin.utils.redirectTo`")},a.prototype.oldURLEventError=function(){throw new Error("!router:changeURL event was removed.")},a.prototype.createHistory=function(){return d.history=new f},a.prototype.startHistory=function(){return d.history.start(this.options)},a.prototype.stopHistory=function(){if(d.History.started)return d.history.stop()},a.prototype.findHandler=function(a){var b,c,e,f;for(f=d.history.handlers,c=0,e=f.length;c<e;c++)if(b=f[c],a(b))return b},a.prototype.match=function(a,b,c){var e,f,h,j,k;if(null==c&&(c={}),2===arguments.length&&b&&"object"==typeof b){if(h=c=b,f=h.controller,e=h.action,!f||!e)throw new Error("Router#match must receive either target or options.controller & options.action")}else{if(f=c.controller,e=c.action,f||e)throw new Error("Router#match cannot use both target and options.controller / options.action");j=b.split("#"),f=j[0],e=j[1]}return i.defaults(c,{trailing:this.options.trailing}),k=new g(a,f,e,c),d.history.handlers.push({route:k,callback:k.handler}),k},a.prototype.route=function(a,b,c){var d,e,f;if(a&&"object"==typeof a&&(e=a.url,!b&&a.params&&(b=a.params)),b=Array.isArray(b)?b.slice():i.extend({},b),null!=e?(e=e.replace(this.removeRoot,""),d=this.findHandler(function(a){return a.route.test(e)}),c=b,b=null):(c=i.extend({},c),d=this.findHandler(function(c){return!(!c.route.matches(a)||!(b=c.route.normalizeParams(b)))})),d)return i.defaults(c,{changeURL:!0}),f=null!=e?e:b,d.callback(f,c),!0;throw new Error("Router#route: request was not routed")},a.prototype.reverse=function(a,b,c){var e,f,g,h,i,j,k;if(j=this.options.root,null!=b&&"object"!=typeof b)throw new TypeError("Router#reverse: params must be an array or an object");for(f=d.history.handlers,g=0,h=f.length;g<h;g++)if(e=f[g],e.route.matches(a)&&(i=e.route.reverse(b,c),i!==!1))return k=j?j+i:i;throw new Error("Router#reverse: invalid route criteria specified: "+JSON.stringify(a))},a.prototype.changeURL=function(a,b,c,e){var f,g;if(null!=c.path&&null!=e&&e.changeURL)return g=c.path+(c.query?"?"+c.query:""),f={trigger:e.trigger===!0,replace:e.replace===!0},d.history.navigate(g,f)},a.prototype.disposed=!1,a.prototype.dispose=function(){if(!this.disposed)return this.stopHistory(),delete d.history,this.unsubscribeAllEvents(),j.removeHandlers(this),this.disposed=!0,Object.freeze(this)},a}()},{"../mediator":14,"./event_broker":7,"./history":8,"./route":9,"./utils":13,backbone:"backbone",underscore:"underscore"}],11:[function(a,b,c){"use strict";b.exports={propertyDescriptors:!0}},{}],12:[function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m;for(h="unsynced",f="syncing",e="synced",d="syncStateChange",g={_syncState:h,_previousSyncState:null,syncState:function(){return this._syncState},isUnsynced:function(){return this._syncState===h},isSynced:function(){return this._syncState===e},isSyncing:function(){return this._syncState===f},unsync:function(){var a;(a=this._syncState)!==f&&a!==e||(this._previousSync=this._syncState,this._syncState=h,this.trigger(this._syncState,this,this._syncState),this.trigger(d,this,this._syncState))},beginSync:function(){var a;(a=this._syncState)!==h&&a!==e||(this._previousSync=this._syncState,this._syncState=f,this.trigger(this._syncState,this,this._syncState),this.trigger(d,this,this._syncState))},finishSync:function(){this._syncState===f&&(this._previousSync=this._syncState,this._syncState=e,this.trigger(this._syncState,this,this._syncState),this.trigger(d,this,this._syncState))},abortSync:function(){this._syncState===f&&(this._syncState=this._previousSync,this._previousSync=this._syncState,this.trigger(this._syncState,this,this._syncState),this.trigger(d,this,this._syncState))}},m=[h,f,e,d],j=function(a){return g[a]=function(b,c){if(null==c&&(c=this),this.on(a,b,c),this._syncState===a)return b.call(c)}},k=0,l=m.length;k<l;k++)i=m[k],j(i);Object.freeze(g),b.exports=g},{}],13:[function(a,b,c){"use strict";var d,e=[].slice,f=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};d={isEmpty:function(a){return!Object.getOwnPropertyNames(a).length},serialize:function(a){if("function"==typeof a.serialize)return a.serialize();if("function"==typeof a.toJSON)return a.toJSON();throw new TypeError("utils.serialize: Unknown data was passed")},readonly:function(){var a,b,c,d,f;for(f=arguments[0],c=2<=arguments.length?e.call(arguments,1):[],a=0,d=c.length;a<d;a++)b=c[a],Object.defineProperty(f,b,{value:f[b],writable:!1,configurable:!1});return!0},getPrototypeChain:function(a){var b;for(b=[];a=Object.getPrototypeOf(a);)b.unshift(a);return b},getAllPropertyVersions:function(a,b){var c,e,g,h,i,j;for(i=[],h=d.getPrototypeChain(a),c=0,e=h.length;c<e;c++)g=h[c],j=g[b],j&&f.call(i,j)<0&&i.push(j);return i},upcase:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},escapeRegExp:function(a){return String(a||"").replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},modifierKeyPressed:function(a){return a.shiftKey||a.altKey||a.ctrlKey||a.metaKey},reverse:function(b,c,d){return a("../mediator").execute("router:reverse",b,c,d)},redirectTo:function(b,c,d){return a("../mediator").execute("router:route",b,c,d)},loadModule:function(){var a,b,c;return a=window.define,c=window.require,"function"==typeof a&&a.amd?function(a,b){return c([a],b)}:(b="undefined"!=typeof setImmediate&&null!==setImmediate?setImmediate:setTimeout,function(a,d){return b(function(){return d(c(a))})})}(),matchesSelector:function(){var a,b;return a=document.documentElement,b=a.matches||a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector,function(){return b.call.apply(b,arguments)}}(),querystring:{stringify:function(a,b){return null==a&&(a={}),"function"!=typeof b&&(b=function(a,b){return Array.isArray(b)?b.map(function(b){return{key:a,value:b}}):null!=b?{key:a,value:b}:void 0}),Object.keys(a).reduce(function(c,d){var e;return e=b(d,a[d]),c.concat(e||[])},[]).map(function(a){var b,c;return b=a.key,c=a.value,[b,c].map(encodeURIComponent).join("=")}).join("&")},parse:function(a,b){return null==a&&(a=""),"function"!=typeof b&&(b=function(a,b){return{key:a,value:b}}),a=a.slice(1+a.indexOf("?")),a.split("&").reduce(function(a,c){var d,e,f,g;return e=c.split("=").map(decodeURIComponent),f=b.apply(null,e)||{},d=f.key,g=f.value,null!=g&&(a[d]=a.hasOwnProperty(d)?[].concat(a[d],g):g),a},{})}}},d.beget=Object.create,d.indexOf=function(a,b){return a.indexOf(b)},d.isArray=Array.isArray,d.queryParams=d.querystring,Object.seal(d),b.exports=d},{"../mediator":14}],14:[function(a,b,c){"use strict";var d,e,f,g,h=[].slice;d=a("backbone"),g=a("./lib/utils"),f={},f.subscribe=f.on=d.Events.on,f.subscribeOnce=f.once=d.Events.once,f.unsubscribe=f.off=d.Events.off,f.publish=f.trigger=d.Events.trigger,f._callbacks=null,e=f._handlers={},f.setHandler=function(a,b,c){return e[a]={instance:c,method:b}},f.execute=function(){var a,b,c,d,f;if(d=arguments[0],a=2<=arguments.length?h.call(arguments,1):[],d&&"object"==typeof d?(c=d.name,f=d.silent):c=d,b=e[c])return b.method.apply(b.instance,a);if(!f)throw new Error("mediator.execute: "+c+" handler is not defined")},f.removeHandlers=function(a){var b,c,d,g;if(a||(f._handlers={}),Array.isArray(a))for(c=0,d=a.length;c<d;c++)g=a[c],delete e[g];else for(g in e)b=e[g],b.instance===a&&delete e[g]},f.seal=function(){return Object.seal(f)},g.readonly(f,"subscribe","subscribeOnce","unsubscribe","publish","setHandler","execute","removeHandlers","seal"),b.exports=f},{"./lib/utils":13,backbone:"backbone"}],15:[function(a,b,c){"use strict";var d,e,f,g,h,i,j=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},k={}.hasOwnProperty;h=a("underscore"),d=a("backbone"),g=a("./model"),f=a("../lib/event_broker"),i=a("../lib/utils"),b.exports=e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),h.extend(b.prototype,f),b.prototype.model=g,b.prototype.serialize=function(){return this.map(i.serialize)},b.prototype.disposed=!1,b.prototype.dispose=function(){var a,b,c,d;if(!this.disposed){for(this.trigger("dispose",this),this.reset([],{silent:!0}),this.unsubscribeAllEvents(),this.stopListening(),this.off(),d=["model","models","_byCid","_callbacks"],a=0,b=d.length;a<b;a++)c=d[a],delete this[c];return this._byId={},this.disposed=!0,Object.freeze(this)}},b}(d.Collection)},{"../lib/event_broker":7,"../lib/utils":13,"./model":16,backbone:"backbone",underscore:"underscore"}],16:[function(a,b,c){"use strict";var d,e,f,g,h,i,j=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},k={}.hasOwnProperty;g=a("underscore"),d=a("backbone"),e=a("../lib/event_broker"),h=function(a,b,c){var e,f,g,h,j,k,l,m;e=Object.create(b),null==c&&(c={}),c[a.cid]=!0;for(g in b)if(m=b[g],m instanceof d.Model)e[g]=i(m,a,c);else if(m instanceof d.Collection){for(l=[],k=m.models,f=0,h=k.length;f<h;f++)j=k[f],l.push(i(j,a,c));e[g]=l}return delete c[a.cid],e},i=function(a,b,c){var d;return a===b||a.cid in c?null:(d="function"==typeof a.getAttributes?a.getAttributes():a.attributes,h(a,d,c))},b.exports=f=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),g.extend(b.prototype,e),b.prototype.getAttributes=function(){return this.attributes},b.prototype.serialize=function(){return h(this,this.getAttributes())},b.prototype.disposed=!1,b.prototype.dispose=function(){var a,b,c,d,e;if(!this.disposed){for(this.trigger("dispose",this),null!=(d=this.collection)&&"function"==typeof d.remove&&d.remove(this,{silent:!0}),this.unsubscribeAllEvents(),this.stopListening(),this.off(),e=["collection","attributes","changed","defaults","_escapedAttributes","_previousAttributes","_silent","_pending","_callbacks"],a=0,b=e.length;a<b;a++)c=e[a],delete this[c];return this.disposed=!0,Object.freeze(this)}},b}(d.Model)},{"../lib/event_broker":7,backbone:"backbone",underscore:"underscore"}],17:[function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n,o=function(a,b){return function(){return a.apply(b,arguments)}},p=function(a,b){function c(){this.constructor=a}for(var d in b)q.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},q={}.hasOwnProperty;e=a("backbone"),g=a("./view"),n=a("../lib/utils"),d=e.$,j=function(a,b){var c,d,e,f;if(!b)return a;for(f=[],c=0,d=a.length;c<d;c++)e=a[c],n.matchesSelector(e,b)&&f.push(e);return f},m=function(){return d?function(a,b){return a.toggle(b)}:function(a,b){return a.style.display=b?"":"none"}}(),h=function(){return d?function(a,b){return a.addClass(b)}:function(a,b){return a.classList.add(b)}}(),l=function(){return d?function(a,b,c){return b?h(a,c):a.css("opacity",0)}:function(a,b,c){return b?h(a,c):a.style.opacity=0}}(),i=function(){return d?function(a,b){return a.animate({opacity:1},b)}:function(a,b){return a.style.transition="opacity "+b+"ms",a.style.opacity=1}}(),k=function(){return d?function(a,b,c,d,e){var f,g,h,i,j;return h=0<c&&c<d,i=function(a){return 0===a||c>=a},h||e?(f=a.children(e),g=f.length,f[c]!==b?i(g)?a.append(b):0===c?f.eq(c).before(b):f.eq(c-1).after(b):void 0):(j=i(d)?"append":"prepend",a[j](b))}:function(a,b,c,d,e){var f,g,h,i,k;return h=0<c&&c<d,i=function(a){return 0===a||c===a},h||e?(f=j(a.children,e),g=f.length,f[c]!==b?i(g)?a.appendChild(b):0===c?a.insertBefore(b,f[c]):(k=f[c-1],
a.lastChild===k?a.appendChild(b):a.insertBefore(b,k.nextElementSibling)):void 0):i(d)?a.appendChild(b):a.insertBefore(b,a.firstChild)}}(),b.exports=f=function(a){function b(a){this.renderAllItems=o(this.renderAllItems,this),this.toggleFallback=o(this.toggleFallback,this),this.itemsReset=o(this.itemsReset,this),this.itemRemoved=o(this.itemRemoved,this),this.itemAdded=o(this.itemAdded,this),this.visibleItems=[],b.__super__.constructor.apply(this,arguments)}return p(b,a),b.prototype.itemView=null,b.prototype.autoRender=!0,b.prototype.renderItems=!0,b.prototype.animationDuration=500,b.prototype.useCssAnimation=!1,b.prototype.animationStartClass="animated-item-view",b.prototype.animationEndClass="animated-item-view-end",b.prototype.listSelector=null,b.prototype.$list=null,b.prototype.fallbackSelector=null,b.prototype.$fallback=null,b.prototype.loadingSelector=null,b.prototype.$loading=null,b.prototype.itemSelector=null,b.prototype.filterer=null,b.prototype.filterCallback=function(a,b){return d&&a.$el.stop(!0,!0),m(d?a.$el:a.el,b)},b.prototype.visibleItems=null,b.prototype.optionNames=g.prototype.optionNames.concat(["renderItems","itemView"]),b.prototype.initialize=function(a){if(null==a&&(a={}),this.addCollectionListeners(),null!=a.filterer)return this.filter(a.filterer)},b.prototype.addCollectionListeners=function(){return this.listenTo(this.collection,"add",this.itemAdded),this.listenTo(this.collection,"remove",this.itemRemoved),this.listenTo(this.collection,"reset sort",this.itemsReset)},b.prototype.getTemplateData=function(){var a;return a={length:this.collection.length},"function"==typeof this.collection.isSynced&&(a.synced=this.collection.isSynced()),a},b.prototype.getTemplateFunction=function(){},b.prototype.render=function(){var a;if(b.__super__.render.apply(this,arguments),a="function"==typeof this.listSelector?this.listSelector():this.listSelector,d?this.$list=a?this.find(a):this.$el:this.list=a?this.find(this.listSelector):this.el,this.initFallback(),this.initLoadingIndicator(),this.renderItems)return this.renderAllItems()},b.prototype.itemAdded=function(a,b,c){return this.insertView(a,this.renderItem(a),c.at)},b.prototype.itemRemoved=function(a){return this.removeViewForItem(a)},b.prototype.itemsReset=function(){return this.renderAllItems()},b.prototype.initFallback=function(){if(this.fallbackSelector)return d?this.$fallback=this.find(this.fallbackSelector):this.fallback=this.find(this.fallbackSelector),this.on("visibilityChange",this.toggleFallback),this.listenTo(this.collection,"syncStateChange",this.toggleFallback),this.toggleFallback()},b.prototype.toggleFallback=function(){var a;return a=0===this.visibleItems.length&&("function"!=typeof this.collection.isSynced||this.collection.isSynced()),m(d?this.$fallback:this.fallback,a)},b.prototype.initLoadingIndicator=function(){if(this.loadingSelector&&"function"==typeof this.collection.isSyncing)return d?this.$loading=this.find(this.loadingSelector):this.loading=this.find(this.loadingSelector),this.listenTo(this.collection,"syncStateChange",this.toggleLoadingIndicator),this.toggleLoadingIndicator()},b.prototype.toggleLoadingIndicator=function(){var a;return a=0===this.collection.length&&this.collection.isSyncing(),m(d?this.$loading:this.loading,a)},b.prototype.getItemViews=function(){var a,b,c,d,e;for(b={},e=Object.keys(this.subviewsByName),a=0,d=e.length;a<d;a++)c=e[a],c.indexOf("itemView:")||(b[c.slice(9)]=this.subviewsByName[c]);return b},b.prototype.filter=function(a,b){var c,d,e,f,g,h,i,j;if("function"!=typeof a&&null!==a||(this.filterer=a),"function"!=typeof b&&null!==b||(this.filterCallback=b),c=Object.keys(this.subviewsByName).some(function(a){return 0===a.indexOf("itemView:")}))for(i=this.collection.models,f=d=0,h=i.length;d<h;f=++d){if(g=i[f],e="function"!=typeof this.filterer||this.filterer(g,f),j=this.subview("itemView:"+g.cid),!j)throw new Error("CollectionView#filter: no view found for "+g.cid);this.filterCallback(j,e),this.updateVisibleItems(j.model,e,!1)}return this.trigger("visibilityChange",this.visibleItems)},b.prototype.renderAllItems=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;for(e=this.collection.models,this.visibleItems.length=0,l={},b=0,h=e.length;b<h;b++)d=e[b],m=this.subview("itemView:"+d.cid),m&&(l[d.cid]=m);for(k=Object.keys(this.getItemViews()),f=0,i=k.length;f<i;f++)a=k[f],a in l||this.removeSubview("itemView:"+a);for(c=g=0,j=e.length;g<j;c=++g)d=e[c],m=this.subview("itemView:"+d.cid),m?this.insertView(d,m,c,!1):this.insertView(d,this.renderItem(d),c);if(0===e.length)return this.trigger("visibilityChange",this.visibleItems)},b.prototype.renderItem=function(a){var b;return b=this.subview("itemView:"+a.cid),b||(b=this.initItemView(a),this.subview("itemView:"+a.cid,b)),b.render(),b},b.prototype.initItemView=function(a){if(this.itemView)return new this.itemView({autoRender:!1,model:a});throw new Error("The CollectionView#itemView property must be defined or the initItemView() must be overridden.")},b.prototype.insertView=function(a,b,c,e){var f,g,j,m;return null==e&&(e=!0),0===this.animationDuration&&(e=!1),"number"!=typeof c&&(c=this.collection.indexOf(a)),g="function"!=typeof this.filterer||this.filterer(a,c),f=d?b.$el:b.el,g&&e&&l(f,this.useCssAnimation,this.animationStartClass),this.filterer&&this.filterCallback(b,g),j=this.collection.length,m=d?this.$list:this.list,g&&(k(m,f,c,j,this.itemSelector),b.trigger("addedToParent")),this.updateVisibleItems(a,g),g&&e&&(this.useCssAnimation?setTimeout(function(a){return function(){return h(f,a.animationEndClass)}}(this)):i(f,this.animationDuration)),b},b.prototype.removeViewForItem=function(a){return this.updateVisibleItems(a,!1),this.removeSubview("itemView:"+a.cid)},b.prototype.updateVisibleItems=function(a,b,c){var d,e,f;return null==c&&(c=!0),e=!1,f=this.visibleItems.indexOf(a),d=f!==-1,b&&!d?(this.visibleItems.push(a),e=!0):!b&&d&&(this.visibleItems.splice(f,1),e=!0),e&&c&&this.trigger("visibilityChange",this.visibleItems),e},b.prototype.dispose=function(){var a,c,d,e;if(!this.disposed){for(e=["$list","$fallback","$loading","visibleItems"],a=0,c=e.length;a<c;a++)d=e[a],delete this[d];return b.__super__.dispose.apply(this,arguments)}},b}(g)},{"../lib/utils":13,"./view":19,backbone:"backbone"}],18:[function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l=function(a,b){return function(){return a.apply(b,arguments)}},m=function(a,b){function c(){this.constructor=a}for(var d in b)n.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},n={}.hasOwnProperty;i=a("underscore"),e=a("backbone"),h=a("./view"),f=a("../lib/event_broker"),k=a("../lib/utils"),j=a("../mediator"),d=e.$,b.exports=g=function(a){function b(a){null==a&&(a={}),this.openLink=l(this.openLink,this),this.globalRegions=[],this.title=a.title,a.regions&&(this.regions=a.regions),this.settings=i.defaults(a,{titleTemplate:function(a){var b;return b=a.subtitle?a.subtitle+" – ":"",b+a.title},openExternalToBlank:!1,routeLinks:"a, .go-to",skipRouting:".noscript",scrollTo:[0,0]}),j.setHandler("region:show",this.showRegion,this),j.setHandler("region:register",this.registerRegionHandler,this),j.setHandler("region:unregister",this.unregisterRegionHandler,this),j.setHandler("region:find",this.regionByName,this),j.setHandler("adjustTitle",this.adjustTitle,this),b.__super__.constructor.apply(this,arguments),this.settings.routeLinks&&this.startLinkRouting()}return m(b,a),b.prototype.el="body",b.prototype.keepElement=!0,b.prototype.title="",b.prototype.globalRegions=null,b.prototype.listen={"beforeControllerDispose mediator":"scroll"},b.prototype.scroll=function(){var a,b,c;if(a=this.settings.scrollTo,a&&"object"==typeof a)return b=a[0],c=a[1],window.scrollTo(b,c)},b.prototype.adjustTitle=function(a){var b;return null==a&&(a=""),b=this.settings.titleTemplate({title:this.title,subtitle:a}),document.title=b,this.publishEvent("adjustTitle",a,b),b},b.prototype.startLinkRouting=function(){var a;if(a=this.settings.routeLinks)return this.delegate("click",a,this.openLink)},b.prototype.stopLinkRouting=function(){var a;if(a=this.settings.routeLinks)return this.undelegate("click",a)},b.prototype.isExternalLink=function(a){var b,c,d;return!!k.matchesSelector(a,"a, area")&&(!!a.download||(a.host||(a.href+=""),c=location.protocol,b=location.host,d=a.target,"_blank"===d||"external"===a.rel||a.protocol!==c||a.host!==b||"_parent"===d&&parent!==self||"_top"===d&&top!==self))},b.prototype.openLink=function(a){var b,c,e;if(!k.modifierKeyPressed(a)&&(b=d?a.currentTarget:a.delegateTarget,c=b.getAttribute("href")||b.getAttribute("data-href"),c&&"#"!==c[0])){switch(e=this.settings.skipRouting,typeof e){case"function":if(!e(c,b))return;break;case"string":if(k.matchesSelector(b,e))return}return this.isExternalLink(b)?void(this.settings.openExternalToBlank&&(a.preventDefault(),this.openWindow(c))):(k.redirectTo({url:c}),a.preventDefault())}},b.prototype.openWindow=function(a){return window.open(a)},b.prototype.registerRegionHandler=function(a,b,c){return null!=b?this.registerGlobalRegion(a,b,c):this.registerGlobalRegions(a)},b.prototype.registerGlobalRegion=function(a,b,c){return this.unregisterGlobalRegion(a,b),this.globalRegions.unshift({instance:a,name:b,selector:c})},b.prototype.registerGlobalRegions=function(a){var b,c,d,e,f,g;for(e=k.getAllPropertyVersions(a,"regions"),b=0,c=e.length;b<c;b++){g=e[b];for(d in g)f=g[d],this.registerGlobalRegion(a,d,f)}},b.prototype.unregisterRegionHandler=function(a,b){return null!=b?this.unregisterGlobalRegion(a,b):this.unregisterGlobalRegions(a)},b.prototype.unregisterGlobalRegion=function(a,b){var c,d;return c=a.cid,this.globalRegions=function(){var a,e,f,g;for(f=this.globalRegions,g=[],a=0,e=f.length;a<e;a++)d=f[a],d.instance.cid===c&&d.name===b||g.push(d);return g}.call(this)},b.prototype.unregisterGlobalRegions=function(a){var b;return this.globalRegions=function(){var c,d,e,f;for(e=this.globalRegions,f=[],c=0,d=e.length;c<d;c++)b=e[c],b.instance.cid!==a.cid&&f.push(b);return f}.call(this)},b.prototype.regionByName=function(a){var b,c,d,e;for(d=this.globalRegions,b=0,c=d.length;b<c;b++)if(e=d[b],e.name===a&&!e.instance.stale)return e},b.prototype.showRegion=function(a,b){var c;if(c=this.regionByName(a),!c)throw new Error("No region registered under "+a);return b.container=""===c.selector?d?c.instance.$el:c.instance.el:c.instance.noWrap?c.instance.container.find(c.selector):c.instance.find(c.selector)},b.prototype.dispose=function(){var a,c,d,e;if(!this.disposed){for(this.stopLinkRouting(),e=["globalRegions","title","route"],a=0,c=e.length;a<c;a++)d=e[a],delete this[d];return j.removeHandlers(this),b.__super__.dispose.apply(this,arguments)}},b}(h)},{"../lib/event_broker":7,"../lib/utils":13,"../mediator":14,"./view":19,backbone:"backbone",underscore:"underscore"}],19:[function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m=function(a,b){function c(){this.constructor=a}for(var d in b)n.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},n={}.hasOwnProperty,o=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};h=a("underscore"),e=a("backbone"),f=a("../lib/event_broker"),l=a("../lib/utils"),j=a("../mediator"),d=e.$,k=function(){return d?function(a,b){return a.$el.html(b),b}:function(a,b){return a.el.innerHTML=b}}(),i=function(){return d?function(a){var b;return b=d(a.container),"function"==typeof a.containerMethod?a.containerMethod(b,a.el):b[a.containerMethod](a.el)}:function(a){var b;return b="string"==typeof a.container?document.querySelector(a.container):a.container,"function"==typeof a.containerMethod?a.containerMethod(b,a.el):b[a.containerMethod](a.el)}}(),b.exports=g=function(a){function b(a){var c,e,f,g,h,i;for(null==a&&(a={}),g=Object.keys(a),c=0,f=g.length;c<f;c++)e=g[c],o.call(this.optionNames,e)>=0&&(this[e]=a[e]);i=this.render,this.render=function(){var a;return!this.disposed&&(a=i.apply(this,arguments),this.autoAttach&&this.attach.apply(this,arguments),a)},this.subviews=[],this.subviewsByName={},this.noWrap&&(this.region&&(h=j.execute("region:find",this.region),null!=h&&(this.el=null!=h.instance.container?null!=h.instance.region?d(h.instance.container).find(h.selector):h.instance.container:h.instance.$(h.selector))),this.container&&(this.el=this.container)),b.__super__.constructor.apply(this,arguments),this.delegateListeners(),this.model&&this.listenTo(this.model,"dispose",this.dispose),this.collection&&this.listenTo(this.collection,"dispose",function(a){return function(b){if(!b||b===a.collection)return a.dispose()}}(this)),null!=this.regions&&j.execute("region:register",this),this.autoRender&&this.render()}return m(b,a),h.extend(b.prototype,f),b.prototype.autoRender=!1,b.prototype.autoAttach=!0,b.prototype.container=null,b.prototype.containerMethod=d?"append":"appendChild",b.prototype.regions=null,b.prototype.region=null,b.prototype.stale=!1,b.prototype.noWrap=!1,b.prototype.keepElement=!1,b.prototype.subviews=null,b.prototype.subviewsByName=null,b.prototype.optionNames=["autoAttach","autoRender","container","containerMethod","region","regions","noWrap"],b.prototype.find=function(a){return d?this.$el.find(a):this.el.querySelector(a)},b.prototype.delegate=function(a,c,e){var f,g,h,i,j,k,l,m;if("string"!=typeof a)throw new TypeError("View#delegate: first argument must be a string");switch(arguments.length){case 2:i=c;break;case 3:if(m=c,i=e,"string"!=typeof m)throw new TypeError("View#delegate: second argument must be a string");break;default:throw new TypeError("View#delegate: only two or three arguments are allowed")}if("function"!=typeof i)throw new TypeError("View#delegate: handler argument must be function");if(f=i.bind(this),d)h=a.split(" ").map(function(a){return function(b){return b+".delegateEvents"+a.cid}}(this)).join(" "),this.$el.on(h,m,f);else for(l=a.split(" "),j=0,k=l.length;j<k;j++)g=l[j],b.__super__.delegate.call(this,g,m,f);return f},b.prototype._delegateEvents=function(a){var b,c,d,e,f,g,h;for(g=Object.keys(a),c=0,e=g.length;c<e;c++){if(d=g[c],h=a[d],b="function"==typeof h?h:this[h],!b)throw new Error("Method `"+h+"` does not exist");f=/^(\S+)\s*(.*)$/.exec(d),this.delegate(f[1],f[2],b)}},b.prototype.delegateEvents=function(a,b){var c,d,e,f;if(b||this.undelegateEvents(),a)return this._delegateEvents(a);for(f=l.getAllPropertyVersions(this,"events"),d=0,e=f.length;d<e;d++)c=f[d],"function"==typeof c&&(c=c.call(this)),this._delegateEvents(c)},b.prototype.undelegate=function(a,c){var e,f;if(null==a&&(a=""),"string"!=typeof a)throw new TypeError("View#undelegate: first argument must be a string");switch(arguments.length){case 2:"string"==typeof c&&(f=c);break;case 3:if(f=c,"string"!=typeof f)throw new TypeError("View#undelegate: second argument must be a string")}return d?(e=a.split(" ").map(function(a){return function(b){return b+".delegateEvents"+a.cid}}(this)).join(" "),this.$el.off(e,f)):a?b.__super__.undelegate.call(this,a,f):this.undelegateEvents()},b.prototype.delegateListeners=function(){var a,b,c,d,e,f,g,h,i,j,k,m;if(this.listen)for(h=l.getAllPropertyVersions(this,"listen"),b=0,e=h.length;b<e;b++)for(m=h[b],"function"==typeof m&&(m=m.call(this)),i=Object.keys(m),c=0,f=i.length;c<f;c++){if(d=i[c],g=m[d],"function"!=typeof g&&(g=this[g]),"function"!=typeof g)throw new Error("View#delegateListeners: "+("listener for `"+d+"` must be function"));j=d.split(" "),a=j[0],k=j[1],this.delegateListener(a,k,g)}},b.prototype.delegateListener=function(a,b,c){var d;"model"===b||"collection"===b?(d=this[b],d&&this.listenTo(d,a,c)):"mediator"===b?this.subscribeEvent(a,c):b||this.on(a,c,this)},b.prototype.registerRegion=function(a,b){return j.execute("region:register",this,a,b)},b.prototype.unregisterRegion=function(a){return j.execute("region:unregister",this,a)},b.prototype.unregisterAllRegions=function(){return j.execute({name:"region:unregister",silent:!0},this)},b.prototype.subview=function(a,b){var c,d;return d=this.subviews,c=this.subviewsByName,a&&b?(this.removeSubview(a),d.push(b),c[a]=b,b):a?c[a]:void 0},b.prototype.removeSubview=function(a){var b,c,d,e,f;if(a&&(e=this.subviews,b=this.subviewsByName,"string"==typeof a?(d=a,f=b[d]):(f=a,Object.keys(b).some(function(a){if(b[a]===f)return d=a})),d&&(null!=f?f.dispose:void 0)))return f.dispose(),c=e.indexOf(f),c!==-1&&e.splice(c,1),delete b[d]},b.prototype.getTemplateData=function(){var a,b;return a=this.model?l.serialize(this.model):this.collection?{items:l.serialize(this.collection),length:this.collection.length}:{},b=this.model||this.collection,b&&("function"!=typeof b.isSynced||"synced"in a||(a.synced=b.isSynced())),a},b.prototype.getTemplateFunction=function(){throw new Error("View#getTemplateFunction must be overridden")},b.prototype.render=function(){var a,b,c;if(this.disposed)return!1;if(c=this.getTemplateFunction(),"function"==typeof c)if(b=c(this.getTemplateData()),this.noWrap){if(a=document.createElement("div"),a.innerHTML=b,a.children.length>1)throw new Error("There must be a single top-level element when using `noWrap`");this.undelegateEvents(),this.setElement(a.firstChild,!0)}else k(this,b);return this},b.prototype.attach=function(){if(null!=this.region&&j.execute("region:show",this.region,this),this.container&&!document.body.contains(this.el))return i(this),this.trigger("addedToDOM")},b.prototype.disposed=!1,b.prototype.dispose=function(){var a,b,c,d,e,f,g,h;if(!this.disposed){for(this.unregisterAllRegions(),f=this.subviews,a=0,c=f.length;a<c;a++)h=f[a],h.dispose();for(this.unsubscribeAllEvents(),this.off(),this.keepElement?(this.undelegateEvents(),this.undelegate(),this.stopListening()):this.remove(),g=["el","$el","options","model","collection","subviews","subviewsByName","_callbacks"],b=0,d=g.length;b<d;b++)e=g[b],delete this[e];return this.disposed=!0,Object.freeze(this)}},b}(e.NativeView||e.View)},{"../lib/event_broker":7,"../lib/utils":13,"../mediator":14,backbone:"backbone",underscore:"underscore"}]},{},[1]))(1)});